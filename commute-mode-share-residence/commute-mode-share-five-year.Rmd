---
title: "Commute Mode Share Five Year"
author: "Shimon Israel"
output:
  html_document:
    theme: cosmo
    toc: yes
---

## Administration

#### Purpose
Consume the Census ACS data for commute mode share and mean travel time by residence location for county geographies and create the flat files needed by Vital Signs. 

#### _ISSUES_
1.  

#### _TODO_
1.  Everything, early days

## Overhead

#### Libraries
```{r overhead}
library(knitr)
suppressMessages(library(plyr))
suppressMessages(library(dplyr))
library(RCurl)
library(RJSONIO)
library(reshape2)

```

#### Knitr config
```{r config, include=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```


#### Parameters
```{r parameters}
key="b901231133cf7da9e4ae3dea1af2470e87b3b9e7"
ACS_year="2014"
ACS_product="5"
#city="00562,00674,01640,02252,03092,05108,05164,05290,06000,08142,08310,09066,09892,10345,13882,14190,14736,16000,16462,16560,17610,17918,17988,19402,20018,20956,21796,22594,23168,23182,25338,26000,29504,31708,33000,33056,33308,33798,39122,40438,41992,43280,43294,44112,46114,46870,47710,47486,47766,48956,49187,49278,49670,50258,50916,52582,53000,53070,54232,54806,55282,56784,56938,57288,57456,57764,57792,58380,60102,60620,60984,62546,62980,64434,65028,65070,67000,68000,68084,68252,68294,68364,68378,69084,70098,70280,70364,70770,72646,73262,64140,75630,77000,78666,81204,81554,81666,83346,85922,86440,86930"

city_timeall="00562,00674,01640,02252,03092,05108,05164,05290,06000,08142,08310,09066,09892,10345,13882,14190,14736,16000,16462,16560,17610,17918,17988,19402,20018,20956,21796,22594,23168,23182,25338,26000,29504,31708,33000,33056,33308,33798,39122,40438,41992,43280,43294,44112,46114,46870,47486,47710,47766,49187,49278,49670,50258,50916,52582,53000,53070,54232,54806,55282,56784,56938,57288,57456,57764,57792,58380,60102,60620,60984,62546,62980,64140,64434,65028,65070,67000,68000,68084,68252,68294,68364,68378,69084,70098,70280,70364,70770,72646,73262,75630,77000,78666,81204,81554,81666,83346,85922,86440,86930"

city_timesub="00562,00674,02252,05108,05290,06000,09066,09892,10345,14736,16000,17610,17918,17988,20018,20956,21796,22594,23182,25338,26000,33000,33308,33798,40438,41992,46114,46870,47486,47766,49187,49670,50916,53000,54806,55282,57288,57456,57764,57792,60102,60620,62546,65028,65070,67000,68000,68084,68252,68378,69084,70098,70364,73262,75630,77000,78666,81204,81554,81666,83346"

work_city="00562,00674,01640,02252,03092,05108,05164,05290,06000,08142,08310,09066,09892,10345,13882,14190,14736,16000,16462,16560,17610,17918,17988,19402,20018,20956,21796,22594,23168,23182,25338,26000,29504,31708,33000,33056,33308,33798,39122,40438,41992,43280,43294,44112,46114,46870,47486,47710,47766,49187,49278,49670,50258,50916,52582,53000,53070,54232,54806,55282,56784,56938,57288,57456,57764,57792,58380,60102,60620,60984,62546,62980,64140,64434,65028,65070,67000,68000,68084,68252,68294,68364,68378,69084,70098,70280,70364,70770,72646,73262,75630,77000,78666,81204,81554,81666,83346,85922,86440,86930"

city_timework="00562,05290,06000,09066,14736,16000,16462,17610,17918,17988,20018,20956,22594,25338,26000,29504,33000,39122,41992,43280,46870,47486,47710,47766,49670,53000,54806,55282,56938,57456,57792,60102,60620,64140,64434,65028,65070,67000,68000,68084,68252,68378,69084,70280,73262,77000,81204,81554,81666,83346,85922,86930"

county="01,13,41,55,75,81,85,95,97"
state="06"
source1="B08301_ACS14_5YR"
source2="B08601_ACS14_5YR"
timesource1="B08013_ACS14_5YR"
timesource2="B08136_ACS14_5YR"
work_timesource1="B08536_ACS14_5YR"
work_source1="B08601_ACS14_5YR"
share_output_csv=paste("C:/Users/sisrae.MTC/Box Sync/Data/1A_Transportation/T1_Commute Mode Share (Home)/",ACS_year,"/",ACS_year,"_",sep = "")
work_share_output_csv=paste("C:/Users/sisrae.MTC/Box Sync/Data/1A_Transportation/T2_Commute Mode Share (Work)/",ACS_year,"/",ACS_year,"_",sep = "")
time_output_csv=paste("C:/Users/sisrae.MTC/Box Sync/Data/1A_Transportation/T3_Commute Time (Home)/",ACS_year,"/",ACS_year,"_",sep = "")
work_time_output_csv=paste("C:/Users/sisrae.MTC/Box Sync/Data/1A_Transportation/T4_Commute Time (Work)",ACS_year,"/",ACS_year,"_",sep = "")

index <- c("DriveTot_Est","DriveAlone_Est","Carpool_Est","Transit_Est","Walk_Est","Other_w_Bike_Est","Bike_Est","Other_Est","Telework_Est", "OverallTime_Est", "DATime_Est", "CPTime_Est", "PTTime_Est") # Transport_Mode index for later reference

values <- c("Share Total Auto","Share Drive Alone","Share Carpool", "Share Transit", "Share Walk", "Share Other With Bike","Share Bike", "Share Other", "Share Work at Home", "Total Mean Travel Time", "Drive Alone Mean Travel Time", "Carpool Mean Travel Time", "Transit Mean Travel Time") #Transport_Mode_Label values for later
```

#### Mode Share API Calls
```{r api-calls}

#Residence Geographies

COMMUTE_CITY = paste("http://api.census.gov/data/",ACS_year,"/acs",ACS_product,"?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:",state,"&for=place:",city_timesub,"&key=", key, sep = "")

#Now Work

WORK_COMMUTE_CITY = paste("http://api.census.gov/data/",ACS_year,"/acs",ACS_product,"?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:",state,"&for=place:",city_timework,"&key=", key, sep = "")

```

#### Consume city commute mode data via Census API via acs package
```{r data - consume commute mode data}
city_mode <- fromJSON(COMMUTE_CITY)
city_mode <- city_mode[2:length(city_mode)]

city_field <- sapply (city_mode, function(x) x[1])
city_Id <- sapply (city_mode, function(x) x[14])
Id <- paste ("1600000US06",city_Id, sep="")
Id2 <- paste ("6",city_Id, sep="")
city_mode_frame <- data.frame(Id, Id2, ACS_year, city_field, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(city_mode, function(x) as.numeric(x[i]))
  
  city_mode_frame <- cbind(city_mode_frame, data.frame(column))
}

city_mode_frame <- cbind(city_mode_frame, source1)

names(city_mode_frame) <-  c("Id", "Id2", "Year", "Residence_Geo", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

city_mode_frame$Residence_Geo <- sapply((strsplit(as.character(city_mode_frame$Residence_Geo),'city,')),function(x) x[1])

city_mode_frame$Residence_Geo <- sapply((strsplit(as.character(city_mode_frame$Residence_Geo),'town,')),function(x) x[1])

```


```{r data - create mode share data by geography}

f.geography <- function (geography) {
  geography <- geography %>%
  mutate (Othertot = Taxi + Motorcycle + Other) %>%
  mutate (Other_w_Bike = Othertot+Bike) %>%
  mutate (DriveTot_Est = Drive_Total / Workers_Est) %>%
  mutate (DriveAlone_Est = DAWorkers_Est / Workers_Est) %>%
  mutate (Carpool_Est = CPWorkers_Est / Workers_Est) %>%
  mutate (Transit_Est = PTWorkers_Est / Workers_Est) %>%
  mutate (Walk_Est = Walk / Workers_Est) %>%
  mutate (Other_w_Bike_Est = Other_w_Bike / Workers_Est) %>%
  mutate (Bike_Est = Bike / Workers_Est) %>%
  mutate (Other_Est = Othertot / Workers_Est) %>%
  mutate (Telework_Est = AtHome / Workers_Est)
  }

city_mode_frame <- f.geography(city_mode_frame)

```

#### Melt data into proper shape for exporting CSVs

```{r data - create new data frame for county mode share}
city_share_frame <- city_mode_frame %>%
  select (Id, Id2, Residence_Geo, Year, Workers_Est, DriveTot_Est, DriveAlone_Est, Carpool_Est, Transit_Est, Walk_Est, Other_w_Bike_Est, Bike_Est, Other_Est, Telework_Est, Source)

city_share_melt <- melt(city_share_frame, 
              id.vars=c("Id", "Id2", "Residence_Geo","Year", "Workers_Est", "Source"),
              variable.name="Transport_Mode",
              value.name="Share"
              )

city_share_melt$Transport_Mode_Label <- values[match(city_share_melt$Transport_Mode, index)]

city_share_melt <- city_share_melt[c(1,2,3,4,5,7,9,8,6)]
 
write.csv(city_share_melt , paste(share_output_csv, "5Year_City_Mode_Share.csv", sep = ""), row.names = FALSE, quote = T)
```


#### Consume city of work commute mode data via Census API via acs package
```{r data - consume city of work commute mode data}
work_city_mode <- fromJSON(WORK_COMMUTE_CITY)
work_city_mode <- work_city_mode[2:length(work_city_mode)]

work_city_field <- sapply (work_city_mode, function(x) x[1])
work_city_Id <- sapply (work_city_mode, function(x) x[14])
Id <- paste ("1600000US06",work_city_Id, sep="")
Id2 <- paste ("6",work_city_Id, sep="")
work_city_mode_frame <- data.frame(Id, Id2, ACS_year, work_city_field, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(work_city_mode, function(x) as.numeric(x[i]))
  
  work_city_mode_frame <- cbind(work_city_mode_frame, data.frame(column))
}

work_city_mode_frame <- cbind(work_city_mode_frame, source2)

names(work_city_mode_frame) <-  c("Id", "Id2", "Year", "Workplace_Geo", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")


```



```{r data - create mode share data by geography}

work_city_mode_frame <- f.geography(work_city_mode_frame)
```

#### Melt data into proper shape for exporting CSVs

```{r data - create new data frame for city of work mode share}
work_city_share_frame <- work_city_mode_frame %>%
  select (Id, Id2, Workplace_Geo, Year, Workers_Est, DriveTot_Est, DriveAlone_Est, Carpool_Est, Transit_Est, Walk_Est, Other_w_Bike_Est, Bike_Est, Other_Est, Telework_Est, Source)

work_city_share_melt <- melt(work_city_share_frame, 
              id.vars=c("Id", "Id2", "Workplace_Geo","Year", "Workers_Est", "Source"),
              variable.name="Transport_Mode",
              value.name="Share"
              )

work_city_share_melt$Transport_Mode_Label <- values[match(work_city_share_melt$Transport_Mode, index)]

work_city_share_melt <- work_city_share_melt[c(1,2,3,4,5,7,9,8,6)]
 
write.csv(work_city_share_melt , paste(work_share_output_csv, "5Year_Work_City_Mode_Share.csv", sep = ""), row.names = FALSE, quote = T)
```



#### Travel Time Total API Calls
```{r api-calls}

TIMEALL_CITY = paste("http://api.census.gov/data/",ACS_year,"/acs",ACS_product,"?get=NAME,B08013_001E&in=state:",state,"&for=place:",city_timeall,"&key=", key, sep = "")

TIMESUB_CITY = paste("http://api.census.gov/data/",ACS_year,"/acs",ACS_product,"?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:",state,"&for=place:",city_timesub,"&key=", key, sep = "")

TIME_CITY_WORK = paste("http://api.census.gov/data/",ACS_year,"/acs",ACS_product,"?get=NAME,B08536_001E,B08536_003E,B08536_004E,B08536_007E&in=state:",state,"&for=place:",city_timework,"&key=", key, sep = "")


```

#### Consume commute travel time data via Census API via acs package

```{r mode - consume city travel time data for aggregate}
city_travel_time <- fromJSON(TIMEALL_CITY)
city_travel_time <- city_travel_time[2:length(city_travel_time)]

city_aggregate_frame <- city_mode_frame %>% 
  select(Id,Id2,Residence_Geo, Year, Workers_Est, AtHome)
  

for (i in 2:2){
  column <- sapply(city_travel_time, function(x) as.numeric(x[i]))
  
  city_aggregate_frame <- cbind(city_aggregate_frame, data.frame(column))
}

city_aggregate_frame <- cbind(city_aggregate_frame, timesource1, source1)

names(city_aggregate_frame) <-  c("Id","Id2","Residence_Geo", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")



city_aggregate_frame <- city_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 
  


```


```{r data - create new data frame for city travel time data for all modes}
city_mean_frame <- city_aggregate_frame %>%
  select (Id,Id2,Residence_Geo, Year, Workers_Est, OverallTime_Est, Source1, Source2)

city_mean_melt <- melt(city_mean_frame, 
              id.vars=c("Id","Id2","Residence_Geo","Year", "Workers_Est", "Source1", "Source2"),
              variable.name="Transport_Mode",
              value.name="Time_Est"
              )

city_mean_melt$Transport_Mode_Label <- values[match(city_mean_melt$Transport_Mode, index)]

city_all_residence_mean_melt <- city_mean_melt[c(1,2,3,4,5,8,10,9,6,7)]
 
#write.csv(city_all_residence_mean_melt , paste(time_output_csv, "5Year_City_Mean_Travel_Time.csv", sep = ""), row.names = FALSE, quote = T)
```

```{r mode - consume city travel time data for submodes}
city_travel_time <- fromJSON(TIMESUB_CITY)
city_travel_time <- city_travel_time[2:length(city_travel_time)]

city_aggregate_frame <- city_mode_frame %>% 
  select(Id,Id2,Residence_Geo, Year, Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est, AtHome)
  

for (i in 2:4){
  column <- sapply(city_travel_time, function(x) as.numeric(x[i]))
  
  city_aggregate_frame <- cbind(city_aggregate_frame, data.frame(column))
}

city_aggregate_frame <- cbind(city_aggregate_frame, timesource2, source1)

names(city_aggregate_frame) <-  c("Id","Id2","Residence_Geo", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "AtHome", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")



city_aggregate_frame <- city_aggregate_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)
  


```


```{r data - melt data frame for city travel time data for submodes}
city_mean_frame <- city_aggregate_frame %>%
  select (Id,Id2,Residence_Geo, Year, Workers_Est, DATime_Est, CPTime_Est, PTTime_Est, Source1, Source2)

city_mean_melt <- melt(city_mean_frame, 
              id.vars=c("Id","Id2","Residence_Geo","Year", "Workers_Est", "Source1", "Source2"),
              variable.name="Transport_Mode",
              value.name="Time_Est"
              )

city_mean_melt$Transport_Mode_Label <- values[match(city_mean_melt$Transport_Mode, index)]

city_sub_residence_mean_melt <- city_mean_melt[c(1,2,3,4,5,8,10,9,6,7)]


city_sum_residence_mean_melt <- rbind (city_all_residence_mean_melt,city_sub_residence_mean_melt)
 
write.csv(city_sum_residence_mean_melt , paste(time_output_csv, "5Year_City_Mean_Travel_Time.csv", sep = ""), row.names = FALSE, quote = T)
```

```{r mode - consume work city travel time data for submodes}
city_travel_time <- fromJSON(TIME_CITY_WORK)
city_travel_time <- city_travel_time[2:length(city_travel_time)]

work_city_aggregate_frame <- work_city_mode_frame %>% 
  select(Id,Id2,Workplace_Geo, Year, Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est, AtHome)
  

for (i in 2:5){
  column <- sapply(city_travel_time, function(x) as.numeric(x[i]))
  
  work_city_aggregate_frame <- cbind(work_city_aggregate_frame, data.frame(column))
}

work_city_aggregate_frame <- cbind(work_city_aggregate_frame, work_timesource1, work_source1)

names(work_city_aggregate_frame) <-  c("Id","Id2","Workplace_Geo", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "AtHome", "Total_Aggregate", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")



work_city_aggregate_frame <- work_city_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)
  


```


```{r data - melt data frame for work city travel time data for submodes}
work_city_mean_frame <- work_city_aggregate_frame %>%
  select (Id,Id2,Workplace_Geo, Year, Workers_Est, OverallTime_Est, DATime_Est, CPTime_Est, PTTime_Est, Source1, Source2)

work_city_mean_melt <- melt(work_city_mean_frame, 
              id.vars=c("Id","Id2","Workplace_Geo","Year", "Workers_Est", "Source1", "Source2"),
              variable.name="Transport_Mode",
              value.name="Time_Est"
              )

work_city_mean_melt$Transport_Mode_Label <- values[match(work_city_mean_melt$Transport_Mode, index)]

work_city_mean_melt <- work_city_mean_melt[c(1,2,3,4,5,8,10,9,6,7)]


write.csv(work_city_mean_melt , paste(time_output_csv, "5Year_Work_City_Mean_Travel_Time.csv", sep = ""), row.names = FALSE, quote = T)
```





















Alameda_residence_timeall_tracts




#### Same process with tracts

#### Consume tract commute mode data via Census API via acs package
```{r data - consume commute mode data for tracts - residence tracts}

ALAMEDA_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:001&for=tract:",Alameda_residence_timesub_tracts)

CONTRA_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:013&for=tract:",Contra_residence_timesub_tracts)

MARIN_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:041&for=tract:",Marin_residence_timesub_tracts)

NAPA_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:055&for=tract:",Napa_residence_timesub_tracts)

FRANCISCO_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:075&for=tract:",Francisco_residence_timesub_tracts)

MATEO_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:081&for=tract:",Mateo_residence_timesub_tracts)

CLARA_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:085&for=tract:",Clara_residence_timesub_tracts)

SOLANO_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:095&for=tract:",Solano_residence_timesub_tracts)

SONOMA_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:097&for=tract:",Sonoma_residence_timesub_tracts)



alameda_tract_mode <- fromJSON(ALAMEDA_COMMUTE_TRACTS)
alameda_tract_mode <- alameda_tract_mode[2:length(alameda_tract_mode)]

tract_field <- sapply (alameda_tract_mode, function(x) x[15])
Id <- paste ("1400000US06001",tract_field,sep="")
Id2 <- paste ("6001",tract_field, sep="")
county <- paste ("Alameda County")
tract <- sapply((strsplit(as.character(sapply (alameda_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(alameda_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

alameda_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(alameda_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Contra Costa

contra_tract_mode <- fromJSON(CONTRA_COMMUTE_TRACTS)
contra_tract_mode <- contra_tract_mode[2:length(contra_tract_mode)]

tract_field <- sapply (contra_tract_mode, function(x) x[15])
Id <- paste ("1400000US06013",tract_field,sep="")
Id2 <- paste ("6013",tract_field, sep="")
county <- paste ("Contra Costa County")
tract <- sapply((strsplit(as.character(sapply (contra_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(contra_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

contra_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(contra_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Marin

marin_tract_mode <- fromJSON(MARIN_COMMUTE_TRACTS)
marin_tract_mode <- marin_tract_mode[2:length(marin_tract_mode)]

tract_field <- sapply (marin_tract_mode, function(x) x[15])
Id <- paste ("1400000US06041",tract_field,sep="")
Id2 <- paste ("6041",tract_field, sep="")
county <- paste ("Marin County")
tract <- sapply((strsplit(as.character(sapply (marin_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(marin_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

marin_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(marin_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Napa

napa_tract_mode <- fromJSON(NAPA_COMMUTE_TRACTS)
napa_tract_mode <- napa_tract_mode[2:length(napa_tract_mode)]

tract_field <- sapply (napa_tract_mode, function(x) x[15])
Id <- paste ("1400000US06055",tract_field,sep="")
Id2 <- paste ("6055",tract_field, sep="")
county <- paste ("Napa County")
tract <- sapply((strsplit(as.character(sapply (napa_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(napa_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

napa_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(napa_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#San Francisco

francisco_tract_mode <- fromJSON(FRANCISCO_COMMUTE_TRACTS)
francisco_tract_mode <- francisco_tract_mode[2:length(francisco_tract_mode)]

tract_field <- sapply (francisco_tract_mode, function(x) x[15])
Id <- paste ("1400000US06075",tract_field,sep="")
Id2 <- paste ("6075",tract_field, sep="")
county <- paste ("San Francisco County")
tract <- sapply((strsplit(as.character(sapply (francisco_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(francisco_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

francisco_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(francisco_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#San Mateo

mateo_tract_mode <- fromJSON(MATEO_COMMUTE_TRACTS)
mateo_tract_mode <- mateo_tract_mode[2:length(mateo_tract_mode)]

tract_field <- sapply (mateo_tract_mode, function(x) x[15])
Id <- paste ("1400000US06081",tract_field,sep="")
Id2 <- paste ("6081",tract_field, sep="")
county <- paste ("San Mateo County")
tract <- sapply((strsplit(as.character(sapply (mateo_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(mateo_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

mateo_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(mateo_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Santa Clara

clara_tract_mode <- fromJSON(CLARA_COMMUTE_TRACTS)
clara_tract_mode <- clara_tract_mode[2:length(clara_tract_mode)]

tract_field <- sapply (clara_tract_mode, function(x) x[15])
Id <- paste ("1400000US06085",tract_field,sep="")
Id2 <- paste ("6085",tract_field, sep="")
county <- paste ("Santa Clara County")
tract <- sapply((strsplit(as.character(sapply (clara_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(clara_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

clara_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(clara_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Solano

solano_tract_mode <- fromJSON(SOLANO_COMMUTE_TRACTS)
solano_tract_mode <- solano_tract_mode[2:length(solano_tract_mode)]

tract_field <- sapply (solano_tract_mode, function(x) x[15])
Id <- paste ("1400000US06095",tract_field,sep="")
Id2 <- paste ("6095",tract_field, sep="")
county <- paste ("Solano County")
tract <- sapply((strsplit(as.character(sapply (solano_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(solano_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

solano_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(solano_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Sonoma

sonoma_tract_mode <- fromJSON(SONOMA_COMMUTE_TRACTS)
sonoma_tract_mode <- sonoma_tract_mode[2:length(sonoma_tract_mode)]

tract_field <- sapply (sonoma_tract_mode, function(x) x[15])
Id <- paste ("1400000US06097",tract_field,sep="")
Id2 <- paste ("6097",tract_field, sep="")
county <- paste ("Sonoma County")
tract <- sapply((strsplit(as.character(sapply (sonoma_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(sonoma_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

sonoma_tract_mode_frame <- cbind(tract_mode_frame, source1)

names(sonoma_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

allcounties_tract_mode_frame <- rbind (alameda_tract_mode_frame,contra_tract_mode_frame,marin_tract_mode_frame,napa_tract_mode_frame,francisco_tract_mode_frame,mateo_tract_mode_frame,clara_tract_mode_frame,solano_tract_mode_frame,sonoma_tract_mode_frame)

allcounties_tract_mode_frame <- f.geography(allcounties_tract_mode_frame)

#Melt data into proper shape for exporting CSVs


#allcounties_tract_share_frame <- allcounties_tract_mode_frame %>%
 # select (Id, Id2, County, Tract, Year, Workers_Est, DriveTot_Est, DriveAlone_Est, Carpool_Est, #Transit_Est, Walk_Est, Other_w_Bike_Est, Bike_Est, Other_Est, Telework_Est, Source)

#allcounties_tract_share_melt <- melt(allcounties_tract_share_frame, 
             # id.vars=c("Id", "Id2", "County","Tract", "Year", "Workers_Est", "Source"),
            #  variable.name="Transport_Mode",
             # value.name="Share"
            #  )

#allcounties_tract_share_melt$Transport_Mode_Label <- values[match(allcounties_tract_share_melt$Transport_Mode, index)]

#allcounties_tract_share_melt <- allcounties_tract_share_melt[c(1,2,3,4,5,6, 8,10,9,7)]
 
#write.csv(allcounties_tract_share_melt , paste(share_output_csv, "5Year_Tract_Mode_Share.csv", sep = ""), row.names = FALSE, quote = T)

```





```{r mode - consume tract travel time data for aggregate}


ALAMEDA_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:001&for=tract:",Alameda_residence_timeall_tracts)

CONTRA_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:013&for=tract:",Contra_residence_timeall_tracts)

MARIN_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:041&for=tract:",Marin_residence_timeall_tracts)

NAPA_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:055&for=tract:",Napa_residence_timeall_tracts)

FRANCISCO_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:075&for=tract:",Francisco_residence_timeall_tracts)

MATEO_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:081&for=tract:",Mateo_residence_timeall_tracts)

CLARA_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:085&for=tract:",Clara_residence_timeall_tracts)

SOLANO_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:095&for=tract:",Solano_residence_timeall_tracts)

SONOMA_TIMEALL_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:097&for=tract:",Sonoma_residence_timeall_tracts)


#Alameda
alameda_tract_timeall <- fromJSON(ALAMEDA_TIMEALL_TRACTS)
alameda_tract_timeall <- alameda_tract_timeall[2:length(alameda_tract_timeall)]

alameda_tract_aggregate_frame <- alameda_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(alameda_tract_timeall, function(x) as.numeric(x[i]))
  
  alameda_tract_aggregate_frame <- cbind(alameda_tract_aggregate_frame, data.frame(column))
}

alameda_tract_aggregate_frame <- cbind(alameda_tract_aggregate_frame, timesource1, source1)

names(alameda_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

alameda_tract_aggregate_frame <- alameda_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 
  

#Contra Costa
contra_tract_timeall <- fromJSON(CONTRA_TIMEALL_TRACTS)
contra_tract_timeall <- contra_tract_timeall[2:length(contra_tract_timeall)]

contra_tract_aggregate_frame <- contra_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(contra_tract_timeall, function(x) as.numeric(x[i]))
  
  contra_tract_aggregate_frame <- cbind(contra_tract_aggregate_frame, data.frame(column))
}

contra_tract_aggregate_frame <- cbind(contra_tract_aggregate_frame, timesource1, source1)

names(contra_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

contra_tract_aggregate_frame <- contra_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#Marin
marin_tract_timeall <- fromJSON(MARIN_TIMEALL_TRACTS)
marin_tract_timeall <- marin_tract_timeall[2:length(marin_tract_timeall)]

marin_tract_aggregate_frame <- marin_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(marin_tract_timeall, function(x) as.numeric(x[i]))
  
  marin_tract_aggregate_frame <- cbind(marin_tract_aggregate_frame, data.frame(column))
}

marin_tract_aggregate_frame <- cbind(marin_tract_aggregate_frame, timesource1, source1)

names(marin_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

marin_tract_aggregate_frame <- marin_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#Napa
napa_tract_timeall <- fromJSON(NAPA_TIMEALL_TRACTS)
napa_tract_timeall <- napa_tract_timeall[2:length(napa_tract_timeall)]

napa_tract_aggregate_frame <- napa_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(napa_tract_timeall, function(x) as.numeric(x[i]))
  
  napa_tract_aggregate_frame <- cbind(napa_tract_aggregate_frame, data.frame(column))
}

napa_tract_aggregate_frame <- cbind(napa_tract_aggregate_frame, timesource1, source1)

names(napa_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

napa_tract_aggregate_frame <- napa_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#San Francisco
francisco_tract_timeall <- fromJSON(FRANCISCO_TIMEALL_TRACTS)
francisco_tract_timeall <- francisco_tract_timeall[2:length(francisco_tract_timeall)]

francisco_tract_aggregate_frame <- francisco_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(francisco_tract_timeall, function(x) as.numeric(x[i]))
  
  francisco_tract_aggregate_frame <- cbind(francisco_tract_aggregate_frame, data.frame(column))
}

francisco_tract_aggregate_frame <- cbind(francisco_tract_aggregate_frame, timesource1, source1)

names(francisco_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

francisco_tract_aggregate_frame <- francisco_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#San Mateo
mateo_tract_timeall <- fromJSON(MATEO_TIMEALL_TRACTS)
mateo_tract_timeall <- mateo_tract_timeall[2:length(mateo_tract_timeall)]

mateo_tract_aggregate_frame <- mateo_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(mateo_tract_timeall, function(x) as.numeric(x[i]))
  
  mateo_tract_aggregate_frame <- cbind(mateo_tract_aggregate_frame, data.frame(column))
}

mateo_tract_aggregate_frame <- cbind(mateo_tract_aggregate_frame, timesource1, source1)

names(mateo_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

mateo_tract_aggregate_frame <- mateo_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#Santa Clara
clara_tract_timeall <- fromJSON(CLARA_TIMEALL_TRACTS)
clara_tract_timeall <- clara_tract_timeall[2:length(clara_tract_timeall)]

clara_tract_aggregate_frame <- clara_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(clara_tract_timeall, function(x) as.numeric(x[i]))
  
  clara_tract_aggregate_frame <- cbind(clara_tract_aggregate_frame, data.frame(column))
}

clara_tract_aggregate_frame <- cbind(clara_tract_aggregate_frame, timesource1, source1)

names(clara_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

clara_tract_aggregate_frame <- clara_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#Solano
solano_tract_timeall <- fromJSON(SOLANO_TIMEALL_TRACTS)
solano_tract_timeall <- solano_tract_timeall[2:length(solano_tract_timeall)]

solano_tract_aggregate_frame <- solano_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(solano_tract_timeall, function(x) as.numeric(x[i]))
  
  solano_tract_aggregate_frame <- cbind(solano_tract_aggregate_frame, data.frame(column))
}

solano_tract_aggregate_frame <- cbind(solano_tract_aggregate_frame, timesource1, source1)

names(solano_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

solano_tract_aggregate_frame <- solano_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

#Sonoma
sonoma_tract_timeall <- fromJSON(SONOMA_TIMEALL_TRACTS)
sonoma_tract_timeall <- sonoma_tract_timeall[2:length(sonoma_tract_timeall)]

sonoma_tract_aggregate_frame <- sonoma_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,AtHome)
  

for (i in 2:2){
  column <- sapply(sonoma_tract_timeall, function(x) as.numeric(x[i]))
  
  sonoma_tract_aggregate_frame <- cbind(sonoma_tract_aggregate_frame, data.frame(column))
}

sonoma_tract_aggregate_frame <- cbind(sonoma_tract_aggregate_frame, timesource1, source1)

names(sonoma_tract_aggregate_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "AtHome", "Total_Aggregate", "Source1", "Source2")

sonoma_tract_aggregate_frame <- sonoma_tract_aggregate_frame %>%
  mutate (NotHome = Workers_Est-AtHome) %>%
  mutate (OverallTime_Est = Total_Aggregate / NotHome) 

allcounties_tract_aggregate_frame <- rbind (alameda_tract_aggregate_frame,contra_tract_aggregate_frame,marin_tract_aggregate_frame,napa_tract_aggregate_frame,francisco_tract_aggregate_frame,mateo_tract_aggregate_frame,clara_tract_aggregate_frame,solano_tract_aggregate_frame,sonoma_tract_aggregate_frame)

```


```{r data - melt all residence tract data into proper shape}
allcounties_tract_mean_frame <- allcounties_tract_aggregate_frame %>%
  select (Id,Id2,County, Tract, Year, Workers_Est, OverallTime_Est, Source1, Source2)

allcounties_tract_mean_melt <- melt(allcounties_tract_mean_frame, 
              id.vars=c("Id","Id2","County","Tract", "Year", "Workers_Est", "Source1", "Source2"),
              variable.name="Transport_Mode",
              value.name="Time_Est"
              )

allcounties_tract_mean_melt$Transport_Mode_Label <- values[match(allcounties_tract_mean_melt$Transport_Mode, index)]

allcounties_tract_mean_melt <- allcounties_tract_mean_melt[c(1,2,3,4,5,6,9,11,10,7,8)]
 
#write.csv(city_mean_melt , paste(time_output_csv, "City_Mean_Travel_Time.csv", sep = ""), row.names = FALSE, quote = T)
```

```{r mode - residence tract time data for submodes}

ALAMEDA_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:001&for=tract:",Alameda_residence_timesub_tracts)

CONTRA_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:013&for=tract:",Contra_residence_timesub_tracts)

MARIN_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:041&for=tract:",Marin_residence_timesub_tracts)

NAPA_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:055&for=tract:",Napa_residence_timesub_tracts)

FRANCISCO_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:075&for=tract:",Francisco_residence_timesub_tracts)

MATEO_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:081&for=tract:",Mateo_residence_timesub_tracts)

CLARA_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:085&for=tract:",Clara_residence_timesub_tracts)

SOLANO_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:095&for=tract:",Solano_residence_timesub_tracts)

SONOMA_TIMESUB_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:097&for=tract:",Sonoma_residence_timesub_tracts)

#Alameda

alameda_tract_timesub <- fromJSON(ALAMEDA_TIMESUB_TRACTS)
alameda_tract_timesub <- alameda_tract_timesub[2:length(alameda_tract_timesub)]

alameda_tract_sub_frame <- alameda_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(alameda_tract_timesub, function(x) as.numeric(x[i]))
  
  alameda_tract_sub_frame <- cbind(alameda_tract_sub_frame, data.frame(column))
}

alameda_tract_sub_frame <- cbind(alameda_tract_sub_frame, timesource2, source1)

names(alameda_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

alameda_tract_sub_frame <- alameda_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)
  
#Alameda

alameda_tract_timesub <- fromJSON(ALAMEDA_TIMESUB_TRACTS)
alameda_tract_timesub <- alameda_tract_timesub[2:length(alameda_tract_timesub)]

alameda_tract_sub_frame <- alameda_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(alameda_tract_timesub, function(x) as.numeric(x[i]))
  
  alameda_tract_sub_frame <- cbind(alameda_tract_sub_frame, data.frame(column))
}

alameda_tract_sub_frame <- cbind(alameda_tract_sub_frame, timesource2, source1)

names(alameda_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

alameda_tract_sub_frame <- alameda_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#Contra Costa

contra_tract_timesub <- fromJSON(CONTRA_TIMESUB_TRACTS)
contra_tract_timesub <- contra_tract_timesub[2:length(contra_tract_timesub)]

contra_tract_sub_frame <- contra_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(contra_tract_timesub, function(x) as.numeric(x[i]))
  
  contra_tract_sub_frame <- cbind(contra_tract_sub_frame, data.frame(column))
}

contra_tract_sub_frame <- cbind(contra_tract_sub_frame, timesource2, source1)

names(contra_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

contra_tract_sub_frame <- contra_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#Marin

marin_tract_timesub <- fromJSON(MARIN_TIMESUB_TRACTS)
marin_tract_timesub <- marin_tract_timesub[2:length(marin_tract_timesub)]

marin_tract_sub_frame <- marin_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(marin_tract_timesub, function(x) as.numeric(x[i]))
  
  marin_tract_sub_frame <- cbind(marin_tract_sub_frame, data.frame(column))
}

marin_tract_sub_frame <- cbind(marin_tract_sub_frame, timesource2, source1)

names(marin_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

marin_tract_sub_frame <- marin_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#Napa

napa_tract_timesub <- fromJSON(NAPA_TIMESUB_TRACTS)
napa_tract_timesub <- napa_tract_timesub[2:length(napa_tract_timesub)]

napa_tract_sub_frame <- napa_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(napa_tract_timesub, function(x) as.numeric(x[i]))
  
  napa_tract_sub_frame <- cbind(napa_tract_sub_frame, data.frame(column))
}

napa_tract_sub_frame <- cbind(napa_tract_sub_frame, timesource2, source1)

names(napa_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

napa_tract_sub_frame <- napa_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#San Francisco

francisco_tract_timesub <- fromJSON(FRANCISCO_TIMESUB_TRACTS)
francisco_tract_timesub <- francisco_tract_timesub[2:length(francisco_tract_timesub)]

francisco_tract_sub_frame <- francisco_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(francisco_tract_timesub, function(x) as.numeric(x[i]))
  
  francisco_tract_sub_frame <- cbind(francisco_tract_sub_frame, data.frame(column))
}

francisco_tract_sub_frame <- cbind(francisco_tract_sub_frame, timesource2, source1)

names(francisco_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

francisco_tract_sub_frame <- francisco_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#San Mateo

mateo_tract_timesub <- fromJSON(MATEO_TIMESUB_TRACTS)
mateo_tract_timesub <- mateo_tract_timesub[2:length(mateo_tract_timesub)]

mateo_tract_sub_frame <- mateo_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(mateo_tract_timesub, function(x) as.numeric(x[i]))
  
  mateo_tract_sub_frame <- cbind(mateo_tract_sub_frame, data.frame(column))
}

mateo_tract_sub_frame <- cbind(mateo_tract_sub_frame, timesource2, source1)

names(mateo_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

mateo_tract_sub_frame <- mateo_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#Santa Clara

clara_tract_timesub <- fromJSON(CLARA_TIMESUB_TRACTS)
clara_tract_timesub <- clara_tract_timesub[2:length(clara_tract_timesub)]

clara_tract_sub_frame <- clara_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(clara_tract_timesub, function(x) as.numeric(x[i]))
  
  clara_tract_sub_frame <- cbind(clara_tract_sub_frame, data.frame(column))
}

clara_tract_sub_frame <- cbind(clara_tract_sub_frame, timesource2, source1)

names(clara_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

clara_tract_sub_frame <- clara_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#Solano

solano_tract_timesub <- fromJSON(SOLANO_TIMESUB_TRACTS)
solano_tract_timesub <- solano_tract_timesub[2:length(solano_tract_timesub)]

solano_tract_sub_frame <- solano_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(solano_tract_timesub, function(x) as.numeric(x[i]))
  
  solano_tract_sub_frame <- cbind(solano_tract_sub_frame, data.frame(column))
}

solano_tract_sub_frame <- cbind(solano_tract_sub_frame, timesource2, source1)

names(solano_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

solano_tract_sub_frame <- solano_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

#Sonoma

sonoma_tract_timesub <- fromJSON(SONOMA_TIMESUB_TRACTS)
sonoma_tract_timesub <- sonoma_tract_timesub[2:length(sonoma_tract_timesub)]

sonoma_tract_sub_frame <- sonoma_tract_mode_frame %>% 
  select(Id,Id2,County,Tract,Year,Workers_Est,DAWorkers_Est, CPWorkers_Est, PTWorkers_Est)

for (i in 2:4){
  column <- sapply(sonoma_tract_timesub, function(x) as.numeric(x[i]))
  
  sonoma_tract_sub_frame <- cbind(sonoma_tract_sub_frame, data.frame(column))
}

sonoma_tract_sub_frame <- cbind(sonoma_tract_sub_frame, timesource2, source1)

names(sonoma_tract_sub_frame) <-  c("Id","Id2","County", "Tract", "Year", "Workers_Est", "DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Drive_Alone_Aggregate","Carpool_Aggregate", "Transit_Aggregate", "Source1", "Source2")

sonoma_tract_sub_frame <- sonoma_tract_sub_frame %>%
  mutate (DATime_Est = Drive_Alone_Aggregate / DAWorkers_Est) %>%
  mutate (CPTime_Est = Carpool_Aggregate / CPWorkers_Est) %>%
  mutate (PTTime_Est = Transit_Aggregate / PTWorkers_Est)

allcounties_tract_sub_frame <- rbind (alameda_tract_sub_frame,contra_tract_sub_frame,marin_tract_sub_frame,napa_tract_sub_frame,francisco_tract_sub_frame,mateo_tract_sub_frame,clara_tract_sub_frame,solano_tract_sub_frame,sonoma_tract_sub_frame)

```

```{r data - melt all submode tract data into proper shape}
allcounties_tract_sub_frame <- allcounties_tract_sub_frame %>%
  select (Id,Id2,County, Tract, Year, Workers_Est, DATime_Est,CPTime_Est,PTTime_Est, Source1, Source2)

allcounties_tract_sub_melt <- melt(allcounties_tract_sub_frame, 
              id.vars=c("Id","Id2","County","Tract", "Year", "Workers_Est", "Source1", "Source2"),
              variable.name="Transport_Mode",
              value.name="Time_Est"
              )

allcounties_tract_sub_melt$Transport_Mode_Label <- values[match(allcounties_tract_sub_melt$Transport_Mode, index)]

allcounties_tract_sub_melt <- allcounties_tract_sub_melt[c(1,2,3,4,5,6,9,11,10,7,8)]

allcounties_tract_sum_melt <- rbind (allcounties_tract_mean_melt, allcounties_tract_sub_melt)
 
write.csv(allcounties_tract_sum_melt, paste(time_output_csv, "5Year_Tract_Mean_Travel_Time.csv", sep = ""), row.names = FALSE, quote = T)
```






```{r data - melt data frame for city travel time data for submodes}
city_mean_frame <- city_aggregate_frame %>%
  select (Id,Id2,Residence_Geo, Year, Workers_Est, DATime_Est, CPTime_Est, PTTime_Est, Source1, Source2)

city_mean_melt <- melt(city_mean_frame, 
              id.vars=c("Id","Id2","Residence_Geo","Year", "Workers_Est", "Source1", "Source2"),
              variable.name="Transport_Mode",
              value.name="Time_Est"
              )

city_mean_melt$Transport_Mode_Label <- values[match(city_mean_melt$Transport_Mode, index)]

city_sub_residence_mean_melt <- city_mean_melt[c(1,2,3,4,5,8,10,9,6,7)]


city_sum_residence_mean_melt <- rbind (city_all_residence_mean_melt,city_sub_residence_mean_melt)
 
#write.csv(city_mean_melt , paste(time_output_csv, "City_Mean_Travel_Time.csv", sep = ""), row.names = FALSE, quote = T)
```


#Mode Calls

#Tract All Modes - Residence
#http://api.census.gov/data/2014/acs5?get=NAME,B08301_001E,B08301_002E,B08301_003E,B08301_004E,B08301_010E,B08301_019E,B08301_018E,B08301_016E,B08301_017E,B08301_020E,B08301_021E&in=state:06+county:001&for=tract:400100

#Tract All Modes - Workplace
#http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:001&for=tract:400100

#Tract Total Travel Time - Residence
#http://api.census.gov/data/2014/acs5?get=NAME,B08013_001E&in=state:06+county:001&for=tract:400100

#Tract Submode Travel Time - Residence
#http://api.census.gov/data/2014/acs5?get=NAME,B08136_003E,B08136_004E,B08136_007E&in=state:06+county:001&for=tract:400100

#Tract Submode Travel Time - Workplace
#http://api.census.gov/data/2014/acs5?get=NAME,B08536_001E,B08536_003E,B08536_004E,B08536_007E&in=state:06+county:001&for=tract:400100

```{r data - residence tracts for mode share}

#Alameda Residence Mode Share Tracts
Alameda_residence_share_tracts="400100,400200,400300,400400,400500,400600,400700,400800,400900,401000,401100,401200,401300,401400,401500,401600,401700,401800,402200,402400,402500,402600,402700,402800,402900,403000,403100,403300,403400,403501,403502,403600,403701,403702,403800,403900,404000,404101,404102,404200,404300,404400,404501,404502,404600,404700,404800,404900,405000,405100,405200,405301,405302,405401,405402,405500,405600,405700,405800,405901,405902,406000,406100,406201,406202,406300,406400,406500,406601,406602,406700,406800,406900,407000,407101,407102,407200,407300,407400,407500,407600,407700,407800,407900,408000,408100,408200,408300,408400,408500,408600,408700,408800,408900,409000,409100,409200,409300,409400,409500,409600,409700,409800,409900,410000,410100,410200,410300,410400,410500,420100,420200,420300,420400,420500,420600,421100,421200,421300,421400,421500,421600,421700,421800,421900,422000,422100,422200,422300,422400,422500,422600,422700,422800,422900,423000,423100,423200,423300,423400,423500,423601,423602,423700,423800,423901,423902,424001,424002,425101,425102,425103,425104,426100,426200,427100,427200,427300,427600,427700,427800,427900,428000,428100,428200,428301,428302,428400,428500,428600,428700,430101,430102,430200,430300,430400,430500,430600,430700,430800,430900,431000,431100,431200,432100,432200,432300,432400,432501,432502,432600,432700,432800,433000,433102,433103,433104,433200,433300,433400,433500,433600,433700,433800,433900,434000,435102,435103,435104,435200,435300,435400,435500,435601,435602,435700,435800,435900,436000,436100,436200,436300,436401,436402,436500,436601,436602,436700,436800,436900,437000,437101,437102,437200,437300,437400,437500,437600,437701,437702,437800,437900,438000,438100,438201,438203,438204,438300,438400,440100,440200,440301,440304,440305,440306,440307,440308,440331,440332,440333,440334,440335,440336,441100,441200,441301,441302,441401,441402,441501,441503,441521,441522,441523,441524,441601,441602,441700,441800,441921,441923,441924,441925,441926,441927,442000,442100,442200,442301,442302,442400,442500,442601,442602,442700,442800,442900,443001,443002,443102,443103,443104,443105,443200,443301,443321,443322,444100,444200,444301,444302,444400,444500,444601,444602,450101,450102,450200,450300,450400,450501,450502,450601,450602,450603,450604,450605,450606,450607,450701,450741,450742,450743,450744,450745,450746,450750,450751,450752,451101,451102,451201,451202,451300,451401,451403,451404,451501,451503,451504,451505,451506,451601,451602,451701,451703,451704,981900,982000,983200,990000"

#Contra Costa CResidence Mode Share Tracts
Contra_residence_share_tracts="301000,302005,302006,302007,302008,302009,302010,303102,303103,303201,303202,303203,303204,303205,304001,304002,304003,304004,304005,305000,306002,306003,306004,307101,307102,307201,307202,307204,307205,308001,308002,309000,310000,311000,312000,313101,313102,313103,313203,313204,313205,313206,314102,314103,314104,314200,315000,316000,317000,318000,319000,320001,320003,320004,321101,321102,321103,321200,322000,323000,324001,324002,325000,326000,327000,328000,329000,330000,331000,332000,333101,333102,333200,334001,334004,334006,334200,335000,336101,336102,336201,336202,337100,337200,337300,338101,338102,338201,338203,338204,338301,338302,339001,339002,340001,340002,341000,343001,343002,343003,345101,345102,345103,345105,345108,345111,345112,345113,345114,345115,345116,345202,345203,345204,346101,346102,346201,346203,346204,347000,348000,349000,350000,351101,351102,351103,351200,352101,352102,352201,352202,353001,353002,354001,354002,355107,355108,355109,355110,355111,355112,355113,355114,355115,355116,355117,355200,355301,355302,355304,355306,356001,356002,357000,358000,359102,359103,359104,359105,359202,359203,359204,360101,360102,360200,361000,362000,363000,364002,365002,365003,366001,366002,367100,367200,368001,368002,369001,369002,370000,371000,372000,373000,374000,375000,376000,377000,378000,379000,380000,381000,382000,383000,384000,385100,385200,386000,387000,388000,389100,389200,390100,390200,391000,392000,392200,392300,990000"

#Marin Residence Mode Share Tracts
Marin_residence_share_tracts="101100,101200,102100,102202,102203,103100,103200,104101,104102,104200,104300,105000,106001,106002,107000,108100,108200,109001,109002,110100,110200,111000,112100,112201,112202,113000,114100,114200,115000,116000,117000,118100,119100,119201,119202,120000,121100,121200,122000,123000,124100,124200,125000,126100,126200,127000,128100,128200,129000,130201,130202,131100,132100,132200,133000,990100"

#Napa Residence Mode Share Tracts
Napa_residence_share_tracts="200201,200202,200203,200301,200302,200400,200501,200503,200504,200505,200601,200602,200703,200704,200705,200706,200707,200802,200803,200804,200900,201003,201004,201005,201006,201007,201101,201102,201200,201300,201401,201402,201403,201500,201601,201602,201700,201800,201900,202000"

#San Francisco Residence Mode Share Tracts
Francisco_residence_share_tracts="010100,010200,010300,010400,010500,010600,010700,010800,010900,011000,011100,011200,011300,011700,011800,011901,011902,012000,012100,012201,012202,012301,012302,012401,012402,012501,012502,012601,012602,012700,012800,012901,012902,013000,013101,013102,013200,013300,013400,013500,015100,015200,015300,015400,015500,015600,015700,015801,015802,015900,016000,016100,016200,016300,016400,016500,016600,016700,016801,016802,016900,017000,017101,017102,017601,017700,017801,017802,017902,018000,020100,020200,020300,020401,020402,020500,020600,020700,020800,020900,021000,021100,021200,021300,021400,021500,021600,021700,021800,022600,022702,022704,022801,022802,022803,022901,022902,022903,023001,023003,023102,023103,023200,023300,023400,025100,025200,025300,025401,025402,025403,025500,025600,025701,025702,025800,025900,026001,026002,026003,026004,026100,026200,026301,026302,026303,026401,026402,026403,026404,030101,030102,030201,030202,030301,030302,030400,030500,030600,030700,030800,030900,031000,031100,031201,031202,031301,031302,031400,032601,032602,032700,032801,032802,032901,032902,033000,033100,033201,033203,033204,035100,035201,035202,035300,035400,040100,040200,042601,042602,042700,042800,045100,045200,047600,047701,047702,047801,047802,047901,047902,060100,060400,060502,060700,061000,061100,061200,061400,061500,980200,980300,980401,980501,980600,980900,990100"

#San Mateo Residence Mode Share Tracts
Mateo_residence_share_tracts="600100,600200,600300,600401,600402,600500,600600,600700,600800,600900,601000,601100,601200,601300,601400,601501,601502,601601,601603,601604,601605,601700,601800,601901,601902,602000,602100,602200,602300,602400,602500,602600,602700,602800,602900,603000,603100,603200,603300,603400,603700,603801,603802,603900,604000,604101,604102,604200,604400,604500,604600,604700,604800,604900,605000,605100,605200,605300,605400,605500,605600,605700,605800,605900,606000,606100,606200,606300,606400,606500,606600,606700,606800,606900,607000,607100,607200,607300,607400,607500,607600,607701,607702,607800,607900,608001,608002,608004,608013,608023,608100,608200,608300,608400,608501,608502,608600,608700,608800,608900,609000,609100,609201,609202,609300,609400,609500,609601,609602,609603,609700,609800,609900,610000,610100,610201,610202,610203,610302,610303,610304,610400,610500,610601,610602,610700,610800,610900,611000,611100,611200,611300,611400,611500,611600,611700,611800,611900,612000,612100,612500,612600,612700,612800,612900,613000,613200,613300,613400,613501,613502,613600,613700,613800,613900,614000,984300,990100"

#Santa Clara Residence Mode Share Tracts
Clara_residence_share_tracts="500100,500200,500300,500400,500500,500600,500800,500901,500902,501000,501101,501102,501200,501300,501401,501402,501501,501502,501600,501700,501800,501900,502001,502002,502101,502102,502201,502202,502301,502302,502400,502500,502601,502603,502604,502701,502702,502800,502901,502902,502903,502906,502907,502908,502909,502910,503001,503002,503003,503105,503108,503110,503111,503112,503113,503115,503116,503117,503118,503121,503122,503123,503204,503207,503208,503210,503211,503212,503213,503214,503217,503218,503304,503305,503306,503312,503313,503315,503321,503322,503323,503324,503325,503326,503327,503329,503330,503331,503332,503333,503334,503336,503337,503401,503402,503504,503506,503507,503508,503509,503510,503511,503601,503602,503703,503707,503708,503709,503710,503711,503712,503713,503802,503803,503804,503902,503903,504001,504002,504101,504102,504201,504202,504307,504308,504311,504314,504315,504316,504317,504318,504319,504320,504321,504322,504323,504410,504411,504412,504413,504414,504415,504416,504417,504418,504420,504421,504422,504423,504504,504505,504506,504507,504601,504602,504700,504802,504803,504805,504806,504901,505001,505006,505007,505008,505009,505100,505202,505203,505301,505302,505303,505304,505305,505401,505402,505403,505500,505600,505700,505800,505900,506000,506101,506102,506103,506202,506203,506204,506301,506302,506304,506305,506401,506402,506501,506502,506503,506601,506603,506604,506605,506606,506701,506702,506703,506801,506802,506803,506804,506900,507001,507002,507100,507203,507205,507206,507301,507302,507401,507402,507500,507600,507701,507702,507703,507805,507806,507807,507808,507903,507904,507905,507906,508001,508003,508004,508101,508102,508202,508203,508204,508301,508303,508304,508401,508403,508404,508503,508504,508505,508507,508508,508601,508602,508703,508704,508800,508900,509000,509102,509105,509106,509107,509108,509109,509201,509202,509302,509303,509304,509401,509403,509404,509500,509600,509700,509801,509802,509901,509902,510001,510002,510100,510200,510300,510400,510500,510600,510700,510801,510802,510803,510900,511000,511100,511200,511301,511302,511400,511500,511608,511609,511701,511702,511704,511705,511707,511800,511905,511907,511909,511910,511911,511912,511913,511914,511915,511916,512001,512005,512017,512019,512020,512021,512022,512023,512024,512025,512026,512027,512029,512030,512031,512032,512033,512034,512035,512036,512037,512038,512039,512042,512043,512045,512047,512052,512053,512100,512200,512305,512307,512308,512309,512310,512311,512312,512313,512314,512401,512402,512503,512505,512506,512508,512509,512510,512602,512603,512604,513000,513500"

#Solano Residence Mode Share Tracts
Solano_residence_share_tracts="250103,250104,250105,250106,250200,250300,250400,250501,250502,250601,250604,250605,250701,250801,250900,251000,251100,251200,251300,251400,251500,251600,251701,251702,251802,251803,251804,251901,251902,251903,252000,252102,252103,252104,252105,252106,252107,252108,252201,252202,252305,252306,252310,252311,252312,252313,252314,252315,252316,252317,252401,252402,252501,252502,252604,252605,252606,252607,252608,252610,252611,252702,252703,252704,252705,252706,252707,252801,252802,252903,252904,252908,252909,252910,252911,252912,252913,252914,252915,253000,253101,253105,253106,253107,253108,253201,253203,253204,253205,253206,253300,253402,253403,253404,253500,980000"

#Sonoma Residence Mode Share Tracts
Sonoma_residence_share_tracts="150100,150202,150203,150204,150303,150304,150305,150306,150500,150601,150602,150603,150607,150609,150610,150611,150612,150701,150702,150800,150901,150902,151000,151100,151201,151203,151204,151301,151305,151306,151307,151308,151309,151310,151311,151401,151402,151502,151503,151504,151601,151602,151700,151800,151900,152000,152100,152201,152202,152203,152300,152400,152501,152502,152600,152701,152702,152801,152802,152903,152904,152905,152906,153001,153002,153003,153005,153006,153102,153103,153104,153200,153300,153401,153403,153404,153501,153502,153600,153703,153704,153705,153706,153801,153804,153806,153807,153808,153809,153901,153902,153903,154000,154100,154201,154202,154302,154303,154304,990100"

```

```{r data - work tracts for mode share}

#Alameda Work Mode Share Tracts
Alameda_work_share_tracts="400100,400200,400300,400400,400500,400600,400700,400800,400900,401000,401100,401200,401300,401400,401500,401600,401700,401800,402200,402400,402500,402600,402700,402800,402900,403000,403100,403300,403400,403501,403502,403600,403701,403702,403800,403900,404000,404101,404102,404200,404300,404400,404501,404502,404600,404700,404800,404900,405000,405100,405200,405301,405302,405401,405402,405500,405600,405700,405800,405901,405902,406000,406100,406201,406202,406300,406400,406500,406601,406602,406700,406800,406900,407000,407101,407102,407200,407300,407400,407500,407600,407700,407800,407900,408000,408100,408200,408300,408400,408500,408600,408700,408800,408900,409000,409100,409200,409300,409400,409500,409600,409700,409800,409900,410000,410100,410200,410300,410400,410500,420100,420200,420300,420400,420500,420600,421100,421200,421300,421400,421500,421600,421700,421800,421900,422000,422100,422200,422300,422400,422500,422600,422700,422800,422900,423000,423100,423200,423300,423400,423500,423601,423602,423700,423800,423901,423902,424001,424002,425101,425102,425103,425104,426100,426200,427100,427200,427300,427600,427700,427800,427900,428000,428100,428200,428301,428302,428400,428500,428600,428700,430101,430102,430200,430300,430400,430500,430600,430700,430800,430900,431000,431100,431200,432100,432200,432300,432400,432501,432502,432600,432700,432800,433000,433102,433103,433104,433200,433300,433400,433500,433600,433700,433800,433900,434000,435102,435103,435104,435200,435300,435400,435500,435601,435602,435700,435800,435900,436000,436100,436200,436300,436401,436402,436500,436601,436602,436700,436800,436900,437000,437101,437102,437200,437300,437400,437500,437600,437701,437702,437800,437900,438000,438100,438201,438203,438204,438300,438400,440100,440200,440301,440304,440305,440306,440307,440308,440331,440332,440333,440334,440335,440336,441100,441200,441301,441302,441401,441402,441501,441503,441521,441522,441523,441524,441601,441602,441700,441800,441921,441923,441924,441925,441926,441927,442000,442100,442200,442301,442302,442400,442500,442601,442602,442700,442800,442900,443001,443002,443102,443103,443104,443105,443200,443301,443321,443322,444100,444200,444301,444302,444400,444500,444601,444602,450101,450102,450200,450300,450400,450501,450502,450601,450602,450603,450604,450605,450606,450607,450701,450741,450742,450743,450744,450745,450746,450750,450751,450752,451101,451102,451201,451202,451300,451401,451403,451404,451501,451503,451504,451505,451506,451601,451602,451701,451703,451704,981900,982000,983200,990000"

#Contra Costa Work Mode Share Tracts
Contra_work_share_tracts="301000,302005,302006,302007,302008,302009,302010,303102,303103,303201,303202,303203,303204,303205,304001,304002,304003,304004,304005,305000,306002,306003,306004,307101,307102,307201,307202,307204,307205,308001,308002,309000,310000,311000,312000,313101,313102,313103,313203,313204,313205,313206,314102,314103,314104,314200,315000,316000,317000,318000,319000,320001,320003,320004,321101,321102,321103,321200,322000,323000,324001,324002,325000,326000,327000,328000,329000,330000,331000,332000,333101,333102,333200,334001,334004,334006,334200,335000,336101,336102,336201,336202,337100,337200,337300,338101,338102,338201,338203,338204,338301,338302,339001,339002,340001,340002,341000,343001,343002,343003,345101,345102,345103,345105,345108,345111,345112,345113,345114,345115,345116,345202,345203,345204,346101,346102,346201,346203,346204,347000,348000,349000,350000,351101,351102,351103,351200,352101,352102,352201,352202,353001,353002,354001,354002,355107,355108,355109,355110,355111,355112,355113,355114,355115,355116,355117,355200,355301,355302,355304,355306,356001,356002,357000,358000,359102,359103,359104,359105,359202,359203,359204,360101,360102,360200,361000,362000,363000,364002,365002,365003,366001,366002,367100,367200,368001,368002,369001,369002,370000,371000,372000,373000,374000,375000,376000,377000,378000,379000,380000,381000,382000,383000,384000,385100,385200,386000,387000,388000,389100,389200,390100,390200,391000,392000,392200,392300,990000"

#Marin Work Mode Share Tracts
Marin_work_share_tracts="101100,101200,102100,102202,102203,103100,103200,104101,104102,104200,104300,105000,106001,106002,107000,108100,108200,109001,109002,110100,110200,111000,112100,112201,112202,113000,114100,114200,115000,116000,117000,118100,119100,119201,119202,120000,121100,121200,122000,123000,124100,124200,125000,126100,126200,127000,128100,128200,129000,130201,130202,131100,132100,132200,133000,990100"

#Napa Work Mode Share Tracts
Napa_work_share_tracts="200201,200202,200203,200301,200302,200400,200501,200503,200504,200505,200601,200602,200703,200704,200705,200706,200707,200802,200803,200804,200900,201003,201004,201005,201006,201007,201101,201102,201200,201300,201401,201402,201403,201500,201601,201602,201700,201800,201900,202000"

#San Francisco Work Mode Share Tracts
Francisco_work_share_tracts="010100,010200,010300,010400,010500,010600,010700,010800,010900,011000,011100,011200,011300,011700,011800,011901,011902,012000,012100,012201,012202,012301,012302,012401,012402,012501,012502,012601,012602,012700,012800,012901,012902,013000,013101,013102,013200,013300,013400,013500,015100,015200,015300,015400,015500,015600,015700,015801,015802,015900,016000,016100,016200,016300,016400,016500,016600,016700,016801,016802,016900,017000,017101,017102,017601,017700,017801,017802,017902,018000,020100,020200,020300,020401,020402,020500,020600,020700,020800,020900,021000,021100,021200,021300,021400,021500,021600,021700,021800,022600,022702,022704,022801,022802,022803,022901,022902,022903,023001,023003,023102,023103,023200,023300,023400,025100,025200,025300,025401,025402,025403,025500,025600,025701,025702,025800,025900,026001,026002,026003,026004,026100,026200,026301,026302,026303,026401,026402,026403,026404,030101,030102,030201,030202,030301,030302,030400,030500,030600,030700,030800,030900,031000,031100,031201,031202,031301,031302,031400,032601,032602,032700,032801,032802,032901,032902,033000,033100,033201,033203,033204,035100,035201,035202,035300,035400,040100,040200,042601,042602,042700,042800,045100,045200,047600,047701,047702,047801,047802,047901,047902,060100,060400,060502,060700,061000,061100,061200,061400,061500,980200,980300,980401,980501,980600,980900,990100"

#San Mateo Work Mode Share Tracts
Mateo_work_share_tracts="600100,600200,600300,600401,600402,600500,600600,600700,600800,600900,601000,601100,601200,601300,601400,601501,601502,601601,601603,601604,601605,601700,601800,601901,601902,602000,602100,602200,602300,602400,602500,602600,602700,602800,602900,603000,603100,603200,603300,603400,603700,603801,603802,603900,604000,604101,604102,604200,604400,604500,604600,604700,604800,604900,605000,605100,605200,605300,605400,605500,605600,605700,605800,605900,606000,606100,606200,606300,606400,606500,606600,606700,606800,606900,607000,607100,607200,607300,607400,607500,607600,607701,607702,607800,607900,608001,608002,608004,608013,608023,608100,608200,608300,608400,608501,608502,608600,608700,608800,608900,609000,609100,609201,609202,609300,609400,609500,609601,609602,609603,609700,609800,609900,610000,610100,610201,610202,610203,610302,610303,610304,610400,610500,610601,610602,610700,610800,610900,611000,611100,611200,611300,611400,611500,611600,611700,611800,611900,612000,612100,612500,612600,612700,612800,612900,613000,613200,613300,613400,613501,613502,613600,613700,613800,613900,614000,984300,990100"

#Santa Clara Work Mode Share Tracts
Clara_work_share_tracts="500100,500200,500300,500400,500500,500600,500800,500901,500902,501000,501101,501102,501200,501300,501401,501402,501501,501502,501600,501700,501800,501900,502001,502002,502101,502102,502201,502202,502301,502302,502400,502500,502601,502603,502604,502701,502702,502800,502901,502902,502903,502906,502907,502908,502909,502910,503001,503002,503003,503105,503108,503110,503111,503112,503113,503115,503116,503117,503118,503121,503122,503123,503204,503207,503208,503210,503211,503212,503213,503214,503217,503218,503304,503305,503306,503312,503313,503315,503321,503322,503323,503324,503325,503326,503327,503329,503330,503331,503332,503333,503334,503336,503337,503401,503402,503504,503506,503507,503508,503509,503510,503511,503601,503602,503703,503707,503708,503709,503710,503711,503712,503713,503802,503803,503804,503902,503903,504001,504002,504101,504102,504201,504202,504307,504308,504311,504314,504315,504316,504317,504318,504319,504320,504321,504322,504323,504410,504411,504412,504413,504414,504415,504416,504417,504418,504420,504421,504422,504423,504504,504505,504506,504507,504601,504602,504700,504802,504803,504805,504806,504901,505001,505006,505007,505008,505009,505100,505202,505203,505301,505302,505303,505304,505305,505401,505402,505403,505500,505600,505700,505800,505900,506000,506101,506102,506103,506202,506203,506204,506301,506302,506304,506305,506401,506402,506501,506502,506503,506601,506603,506604,506605,506606,506701,506702,506703,506801,506802,506803,506804,506900,507001,507002,507100,507203,507205,507206,507301,507302,507401,507402,507500,507600,507701,507702,507703,507805,507806,507807,507808,507903,507904,507905,507906,508001,508003,508004,508101,508102,508202,508203,508204,508301,508303,508304,508401,508403,508404,508503,508504,508505,508507,508508,508601,508602,508703,508704,508800,508900,509000,509102,509105,509106,509107,509108,509109,509201,509202,509302,509303,509304,509401,509403,509404,509500,509600,509700,509801,509802,509901,509902,510001,510002,510100,510200,510300,510400,510500,510600,510700,510801,510802,510803,510900,511000,511100,511200,511301,511302,511400,511500,511608,511609,511701,511702,511704,511705,511707,511800,511905,511907,511909,511910,511911,511912,511913,511914,511915,511916,512001,512005,512017,512019,512020,512021,512022,512023,512024,512025,512026,512027,512029,512030,512031,512032,512033,512034,512035,512036,512037,512038,512039,512042,512043,512045,512047,512052,512053,512100,512200,512305,512307,512308,512309,512310,512311,512312,512313,512314,512401,512402,512503,512505,512506,512508,512509,512510,512602,512603,512604,513000,513500"

#Solano Work Mode Share Tracts
Solano_work_share_tracts="250103,250104,250105,250106,250200,250300,250400,250501,250502,250601,250604,250605,250701,250801,250900,251000,251100,251200,251300,251400,251500,251600,251701,251702,251802,251803,251804,251901,251902,251903,252000,252102,252103,252104,252105,252106,252107,252108,252201,252202,252305,252306,252310,252311,252312,252313,252314,252315,252316,252317,252401,252402,252501,252502,252604,252605,252606,252607,252608,252610,252611,252702,252703,252704,252705,252706,252707,252801,252802,252903,252904,252908,252909,252910,252911,252912,252913,252914,252915,253000,253101,253105,253106,253107,253108,253201,253203,253204,253205,253206,253300,253402,253403,253404,253500,980000"

#Sonoma Work Mode Share Tracts
Sonoma_work_share_tracts="150100,150202,150203,150204,150303,150304,150305,150306,150500,150601,150602,150603,150607,150609,150610,150611,150612,150701,150702,150800,150901,150902,151000,151100,151201,151203,151204,151301,151305,151306,151307,151308,151309,151310,151311,151401,151402,151502,151503,151504,151601,151602,151700,151800,151900,152000,152100,152201,152202,152203,152300,152400,152501,152502,152600,152701,152702,152801,152802,152903,152904,152905,152906,153001,153002,153003,153005,153006,153102,153103,153104,153200,153300,153401,153403,153404,153501,153502,153600,153703,153704,153705,153706,153801,153804,153806,153807,153808,153809,153901,153902,153903,154000,154100,154201,154202,154302,154303,154304,990100"

```



```{r data - residence tracts for mean travel time - timeall}

#Alameda Residence Travel TIme Tracts
Alameda_residence_timeall_tracts="400100,400200,400300,400400,400500,400600,400700,400800,400900,401000,401100,401200,401300,401400,401500,401600,401700,401800,402200,402400,402500,402600,402700,402800,402900,403000,403100,403300,403400,403501,403502,403600,403701,403702,403800,403900,404000,404101,404102,404200,404300,404400,404501,404502,404600,404700,404800,404900,405000,405100,405200,405301,405302,405401,405402,405500,405600,405700,405800,405901,405902,406000,406100,406201,406202,406300,406400,406500,406601,406602,406700,406800,406900,407000,407101,407102,407200,407300,407400,407500,407600,407700,407800,407900,408000,408100,408200,408300,408400,408500,408600,408700,408800,408900,409000,409100,409200,409300,409400,409500,409600,409700,409800,409900,410000,410100,410200,410300,410400,410500,420100,420200,420300,420400,420500,420600,421100,421200,421300,421400,421500,421600,421700,421800,421900,422000,422100,422200,422300,422400,422500,422600,422700,422800,422900,423000,423100,423200,423300,423400,423500,423601,423602,423700,423800,423901,423902,424001,424002,425101,425102,425103,425104,426100,426200,427100,427200,427300,427600,427700,427800,427900,428000,428100,428200,428301,428302,428400,428500,428600,428700,430101,430102,430200,430300,430400,430500,430600,430700,430800,430900,431000,431100,431200,432100,432200,432300,432400,432501,432502,432600,432700,432800,433000,433102,433103,433104,433200,433300,433400,433500,433600,433700,433800,433900,434000,435102,435103,435104,435200,435300,435400,435500,435601,435602,435700,435800,435900,436000,436100,436200,436300,436401,436402,436500,436601,436602,436700,436800,436900,437000,437101,437102,437200,437300,437400,437500,437600,437701,437702,437800,437900,438000,438100,438201,438203,438204,438300,438400,440100,440200,440301,440304,440305,440306,440307,440308,440331,440332,440333,440334,440335,440336,441100,441200,441301,441302,441401,441402,441501,441503,441521,441522,441523,441524,441601,441602,441700,441800,441921,441923,441924,441925,441926,441927,442000,442100,442200,442301,442302,442400,442500,442601,442602,442700,442800,442900,443001,443002,443102,443103,443104,443105,443200,443301,443321,443322,444100,444200,444301,444302,444400,444500,444601,444602,450101,450102,450200,450300,450400,450501,450502,450601,450602,450603,450604,450605,450606,450607,450701,450741,450742,450743,450744,450745,450746,450750,450751,450752,451101,451102,451201,451202,451300,451401,451403,451404,451501,451503,451504,451505,451506,451601,451602,451701,451703,451704,981900,982000,983200"

#Contra Costa CResidence Travel TIme Tracts
Contra_residence_timeall_tracts="301000,302005,302006,302007,302008,302009,302010,303102,303103,303201,303202,303203,303204,303205,304001,304002,304003,304004,304005,305000,306002,306003,306004,307101,307102,307201,307202,307204,307205,308001,308002,309000,310000,311000,312000,313101,313102,313103,313203,313204,313205,313206,314102,314103,314104,314200,315000,316000,317000,318000,319000,320001,320003,320004,321101,321102,321103,321200,322000,323000,324001,324002,325000,326000,327000,328000,329000,330000,331000,332000,333101,333102,333200,334001,334004,334006,334200,335000,336101,336102,336201,336202,337100,337200,337300,338101,338102,338201,338203,338204,338301,338302,339001,339002,340001,340002,341000,343001,343002,343003,345101,345102,345103,345105,345108,345111,345112,345113,345114,345115,345116,345202,345203,345204,346101,346102,346201,346203,346204,347000,348000,349000,350000,351101,351102,351103,351200,352101,352102,352201,352202,353001,353002,354001,354002,355107,355108,355109,355110,355111,355112,355113,355114,355115,355116,355117,355200,355301,355302,355304,355306,356001,356002,357000,358000,359102,359103,359104,359105,359202,359203,359204,360101,360102,360200,361000,362000,363000,364002,365002,365003,366001,366002,367100,367200,368001,368002,369001,369002,370000,371000,372000,373000,374000,375000,376000,377000,378000,379000,380000,381000,382000,383000,384000,385100,385200,386000,387000,388000,389100,389200,390100,390200,391000,392000,392200,392300"

#Marin Residence Travel TIme Tracts
Marin_residence_timeall_tracts="101100,101200,102100,102202,102203,103100,103200,104101,104102,104200,104300,105000,106001,106002,107000,108100,108200,109001,109002,110100,110200,111000,112100,112201,112202,113000,114100,114200,115000,116000,117000,118100,119100,119201,119202,120000,121100,121200,123000,124100,124200,125000,126100,126200,127000,128100,128200,129000,130201,130202,131100,132100,132200,133000"

#Napa Residence Travel TIme Tracts
Napa_residence_timeall_tracts="200201,200202,200203,200301,200302,200400,200501,200503,200504,200505,200601,200602,200703,200704,200705,200706,200707,200802,200803,200804,201003,201004,201005,201006,201007,201101,201102,201200,201300,201401,201402,201403,201500,201601,201602,201700,201800,201900,202000"

#San Francisco Residence Travel TIme Tracts
Francisco_residence_timeall_tracts="010100,010200,010300,010400,010500,010600,010700,010800,010900,011000,011100,011200,011300,011700,011800,011901,011902,012000,012100,012201,012202,012301,012302,012401,012402,012501,012502,012601,012602,012700,012800,012901,012902,013000,013101,013102,013200,013300,013400,013500,015100,015200,015300,015400,015500,015600,015700,015801,015802,015900,016000,016100,016200,016300,016400,016500,016600,016700,016801,016802,016900,017000,017101,017102,017601,017700,017801,017802,017902,018000,020100,020200,020300,020401,020402,020500,020600,020700,020800,020900,021000,021100,021200,021300,021400,021500,021600,021700,021800,022600,022702,022704,022801,022802,022803,022901,022902,022903,023001,023003,023102,023103,023200,023300,023400,025100,025200,025300,025401,025402,025403,025500,025600,025701,025702,025800,025900,026001,026002,026003,026004,026100,026200,026301,026302,026303,026401,026402,026403,026404,030101,030102,030201,030202,030301,030302,030400,030500,030600,030700,030800,030900,031000,031100,031201,031202,031301,031302,031400,032601,032602,032700,032801,032802,032901,032902,033000,033100,033201,033203,033204,035100,035201,035202,035300,035400,040100,040200,042601,042602,042700,042800,045100,045200,047600,047701,047702,047801,047802,047901,047902,060100,060400,060502,060700,061000,061100,061200,061400,061500,980200,980501,980600,980900"

#San Mateo Residence Travel TIme Tracts
Mateo_residence_timeall_tracts="600100,600200,600300,600401,600402,600500,600600,600700,600800,600900,601000,601100,601200,601300,601400,601501,601502,601601,601603,601604,601605,601700,601800,601901,601902,602000,602100,602200,602300,602400,602500,602600,602700,602800,602900,603000,603100,603200,603300,603400,603700,603801,603802,603900,604000,604101,604102,604200,604400,604500,604600,604700,604800,604900,605000,605100,605200,605300,605400,605500,605600,605700,605800,605900,606000,606100,606200,606300,606400,606500,606600,606700,606800,606900,607000,607100,607200,607300,607400,607500,607600,607701,607702,607800,607900,608001,608002,608004,608013,608023,608100,608200,608300,608400,608501,608502,608600,608700,608800,608900,609000,609100,609201,609202,609300,609400,609500,609601,609602,609603,609700,609800,609900,610000,610100,610201,610202,610203,610302,610303,610304,610400,610500,610601,610602,610700,610800,610900,611000,611100,611200,611300,611400,611500,611600,611700,611800,611900,612000,612100,612500,612600,612700,612800,612900,613000,613200,613300,613400,613501,613502,613600,613700,613800,613900,614000"

#Santa Clara Residence Travel TIme Tracts
Clara_residence_timeall_tracts="500100,500200,500300,500400,500500,500600,500800,500901,500902,501000,501101,501102,501200,501300,501401,501402,501501,501502,501600,501700,501800,501900,502001,502002,502101,502102,502201,502202,502301,502302,502400,502500,502601,502603,502604,502701,502702,502800,502901,502902,502903,502906,502907,502908,502909,502910,503001,503002,503003,503105,503108,503110,503111,503112,503113,503115,503116,503117,503118,503121,503122,503123,503204,503207,503208,503210,503211,503212,503213,503214,503217,503218,503304,503305,503306,503312,503313,503315,503321,503322,503323,503324,503325,503326,503327,503329,503330,503331,503332,503333,503334,503336,503337,503401,503402,503504,503506,503507,503508,503509,503510,503511,503601,503602,503703,503707,503708,503709,503710,503711,503712,503713,503802,503803,503804,503902,503903,504001,504002,504101,504102,504201,504202,504307,504308,504311,504314,504315,504316,504317,504318,504319,504320,504321,504322,504323,504410,504411,504412,504413,504414,504415,504416,504417,504418,504420,504421,504422,504423,504504,504505,504506,504507,504601,504602,504700,504802,504803,504805,504806,504901,505001,505006,505007,505008,505009,505100,505202,505203,505301,505302,505303,505304,505305,505401,505402,505403,505500,505600,505700,505800,505900,506000,506101,506102,506103,506202,506203,506204,506301,506302,506304,506305,506401,506402,506501,506502,506503,506601,506603,506604,506605,506606,506701,506702,506703,506801,506802,506803,506804,506900,507001,507002,507100,507203,507205,507206,507301,507302,507401,507402,507500,507600,507701,507702,507703,507805,507806,507807,507808,507903,507904,507905,507906,508001,508003,508004,508101,508102,508202,508203,508204,508301,508303,508304,508401,508403,508404,508503,508504,508505,508507,508508,508601,508602,508703,508704,508800,508900,509000,509102,509105,509106,509107,509108,509109,509201,509202,509302,509303,509304,509401,509403,509404,509500,509600,509700,509801,509802,509901,509902,510001,510002,510100,510200,510300,510400,510500,510600,510700,510801,510802,510803,510900,511000,511100,511200,511301,511302,511400,511500,511608,511609,511701,511702,511704,511705,511707,511800,511905,511907,511909,511910,511911,511912,511913,511914,511915,511916,512001,512005,512017,512019,512020,512021,512022,512023,512024,512025,512026,512027,512029,512030,512031,512032,512033,512034,512035,512036,512037,512038,512039,512042,512043,512045,512047,512052,512053,512100,512200,512305,512307,512308,512309,512310,512311,512312,512313,512314,512401,512402,512503,512505,512506,512508,512509,512510,512602,512603,512604,513000,513500"

#Solano Residence Travel TIme Tracts
Solano_residence_timeall_tracts="250103,250104,250105,250106,250200,250300,250400,250501,250502,250601,250604,250605,250701,250801,250900,251000,251100,251200,251300,251400,251500,251600,251701,251702,251802,251803,251804,251901,251902,251903,252000,252102,252103,252104,252105,252106,252107,252108,252201,252202,252305,252306,252310,252311,252312,252313,252314,252315,252316,252317,252401,252402,252501,252502,252604,252605,252606,252607,252608,252610,252611,252702,252703,252704,252705,252706,252707,252801,252802,252903,252904,252908,252909,252910,252911,252912,252913,252914,252915,253101,253105,253106,253107,253108,253201,253203,253204,253205,253206,253300,253402,253403,253404,253500,980000"

#Sonoma Residence Travel TIme Tracts
Sonoma_residence_timeall_tracts="150100,150202,150203,150204,150303,150304,150305,150306,150500,150601,150602,150603,150607,150609,150610,150611,150612,150701,150702,150800,150901,150902,151000,151100,151201,151203,151204,151301,151305,151306,151307,151308,151309,151310,151311,151401,151402,151502,151503,151504,151601,151602,151700,151800,151900,152000,152100,152201,152202,152203,152300,152400,152501,152502,152600,152701,152702,152801,152802,152903,152904,152905,152906,153001,153002,153003,153005,153006,153102,153103,153104,153200,153300,153401,153403,153404,153501,153502,153600,153703,153704,153705,153706,153801,153804,153806,153807,153808,153809,153901,153902,153903,154000,154100,154201,154202,154302,154303,154304"

```

```{r data - residence tracts for mean travel time - timesub}

#Alameda Residence Travel Time for Submodes Tracts
Alameda_residence_timesub_tracts="400200,401100,402500,403501,403702,404000,404200,404900,405301,405302,405401,405500,405800,406000,406100,406201,407300,407900,408300,408400,408900,409500,409700,420100,420300,420500,421100,421300,421400,421500,421900,422100,422300,422500,422700,422800,423000,423300,423400,423500,423700,423902,425101,425103,426200,427100,427200,427300,427600,427700,428700,432100,432600,433900,436100,436300,436601,437300,437702,440200,440305,441521,441524,442500,444302,444400,450102,450300"

#Contra Costa CResidence Travel Time for Submodes Tracts
Contra_residence_timesub_tracts="303102,305000,307102,307201,313101,314200,345204,349000,352102,355117,359203,364002,367100,368001,377000,378000,379000,381000,388000,389200"

#Marin Residence Travel Time for Submodes Tracts
Marin_residence_timesub_tracts="104101,106002,109001,111000,112201,117000,125000,130202"

#Napa Residence Travel Time for Submodes Tracts
Napa_residence_timesub_tracts="200302,200804,202000"

#San Francisco Residence Travel Time for Submodes Tracts
Francisco_residence_timesub_tracts="010700,016100,016300,016600,016700,016900,017101,017601,020200,020700,020900,021000,021600,021800,022901,023103,025300,025401,025403,025600,025701,026001,026200,026301,026402,030101,030202,030400,030900,032601,033100,035100,035201,035202,047901,060400,061400"

#San Mateo Residence Travel Time for Submodes Tracts
Mateo_residence_timesub_tracts="600200,600500,601200,601300,601400,601502,601601,602000,602100,604101,604400,604800,604900,605100,605200,605400,605700,605800,607400,608002,610203,610400,610500,610601,614000"

#Santa Clara Residence Travel Time for Submodes Tracts
Clara_residence_timesub_tracts="501200,502101,503110,503111,503112,503118,503401,503602,503802,505007,505700,506501,508102,508504,508602,509105,509201,509600,511915,512031,512401,512506,512508,513000"

#Solano Residence Travel Time for Submodes Tracts
Solano_residence_timesub_tracts="250605,251702,252913"

#Sonoma Residence Travel Time for Submodes Tracts
Sonoma_residence_timesub_tracts="150610,150800,150901,151100,151201,151305,151308,151311,151504,151900,152201,153001,153002,153003,153200,153300,153401"

```

#Original tracts (all 1588 for reference)
#Alameda County Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:01&for=tract:400100,400200,400300,400400,400500,400600,400700,400800,400900,401000,401100,401200,401300,401400,401500,401600,401700,401800,402200,402400,402500,402600,402700,402800,402900,403000,403100,403300,403400,403501,403502,403600,403701,403702,403800,403900,404000,404101,404102,404200,404300,404400,404501,404502,404600,404700,404800,404900,405000,405100,405200,405301,405302,405401,405402,405500,405600,405700,405800,405901,405902,406000,406100,406201,406202,406300,406400,406500,406601,406602,406700,406800,406900,407000,407101,407102,407200,407300,407400,407500,407600,407700,407800,407900,408000,408100,408200,408300,408400,408500,408600,408700,408800,408900,409000,409100,409200,409300,409400,409500,409600,409700,409800,409900,410000,410100,410200,410300,410400,410500,420100,420200,420300,420400,420500,420600,421100,421200,421300,421400,421500,421600,421700,421800,421900,422000,422100,422200,422300,422400,422500,422600,422700,422800,422900,423000,423100,423200,423300,423400,423500,423601,423602,423700,423800,423901,423902,424001,424002,425101,425102,425103,425104,426100,426200,427100,427200,427300,427600,427700,427800,427900,428000,428100,428200,428301,428302,428400,428500,428600,428700,430101,430102,430200,430300,430400,430500,430600,430700,430800,430900,431000,431100,431200,432100,432200,432300,432400,432501,432502,432600,432700,432800,433000,433102,433103,433104,433200,433300,433400,433500,433600,433700,433800,433900,434000,435102,435103,435104,435200,435300,435400,435500,435601,435602,435700,435800,435900,436000,436100,436200,436300,436401,436402,436500,436601,436602,436700,436800,436900,437000,437101,437102,437200,437300,437400,437500,437600,437701,437702,437800,437900,438000,438100,438201,438203,438204,438300,438400,440100,440200,440301,440304,440305,440306,440307,440308,440331,440332,440333,440334,440335,440336,441100,441200,441301,441302,441401,441402,441501,441503,441521,441522,441523,441524,441601,441602,441700,441800,441921,441923,441924,441925,441926,441927,442000,442100,442200,442301,442302,442400,442500,442601,442602,442700,442800,442900,443001,443002,443102,443103,443104,443105,443200,443301,443321,443322,444100,444200,444301,444302,444400,444500,444601,444602,450101,450102,450200,450300,450400,450501,450502,450601,450602,450603,450604,450605,450606,450607,450701,450741,450742,450743,450744,450745,450746,450750,450751,450752,451101,451102,451201,451202,451300,451401,451403,451404,451501,451503,451504,451505,451506,451601,451602,451701,451703,451704,981900,982000,983200,990000

#Contra Costa County Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:13&for=tract:301000,302005,302006,302007,302008,302009,302010,303102,303103,303201,303202,303203,303204,303205,304001,304002,304003,304004,304005,305000,306002,306003,306004,307101,307102,307201,307202,307204,307205,308001,308002,309000,310000,311000,312000,313101,313102,313103,313203,313204,313205,313206,314102,314103,314104,314200,315000,316000,317000,318000,319000,320001,320003,320004,321101,321102,321103,321200,322000,323000,324001,324002,325000,326000,327000,328000,329000,330000,331000,332000,333101,333102,333200,334001,334004,334006,334200,335000,336101,336102,336201,336202,337100,337200,337300,338101,338102,338201,338203,338204,338301,338302,339001,339002,340001,340002,341000,343001,343002,343003,345101,345102,345103,345105,345108,345111,345112,345113,345114,345115,345116,345202,345203,345204,346101,346102,346201,346203,346204,347000,348000,349000,350000,351101,351102,351103,351200,352101,352102,352201,352202,353001,353002,354001,354002,355107,355108,355109,355110,355111,355112,355113,355114,355115,355116,355117,355200,355301,355302,355304,355306,356001,356002,357000,358000,359102,359103,359104,359105,359202,359203,359204,360101,360102,360200,361000,362000,363000,364002,365002,365003,366001,366002,367100,367200,368001,368002,369001,369002,370000,371000,372000,373000,374000,375000,376000,377000,378000,379000,380000,381000,382000,383000,384000,385100,385200,386000,387000,388000,389100,389200,390100,390200,391000,392000,392200,392300,990000

#Marin Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:41&for=tract:101100,101200,102100,102202,102203,103100,103200,104101,104102,104200,104300,105000,106001,106002,107000,108100,108200,109001,109002,110100,110200,111000,112100,112201,112202,113000,114100,114200,115000,116000,117000,118100,119100,119201,119202,120000,121100,121200,122000,123000,124100,124200,125000,126100,126200,127000,128100,128200,129000,130201,130202,131100,132100,132200,133000,990100

#Napa Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:55&for=tract:200201,200202,200203,200301,200302,200400,200501,200503,200504,200505,200601,200602,200703,200704,200705,200706,200707,200802,200803,200804,200900,201003,201004,201005,201006,201007,201101,201102,201200,201300,201401,201402,201403,201500,201601,201602,201700,201800,201900,202000

#San Francisco Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:75&for=tract:010100,010200,010300,010400,010500,010600,010700,010800,010900,011000,011100,011200,011300,011700,011800,011901,011902,012000,012100,012201,012202,012301,012302,012401,012402,012501,012502,012601,012602,012700,012800,012901,012902,013000,013101,013102,013200,013300,013400,013500,015100,015200,015300,015400,015500,015600,015700,015801,015802,015900,016000,016100,016200,016300,016400,016500,016600,016700,016801,016802,016900,017000,017101,017102,017601,017700,017801,017802,017902,018000,020100,020200,020300,020401,020402,020500,020600,020700,020800,020900,021000,021100,021200,021300,021400,021500,021600,021700,021800,022600,022702,022704,022801,022802,022803,022901,022902,022903,023001,023003,023102,023103,023200,023300,023400,025100,025200,025300,025401,025402,025403,025500,025600,025701,025702,025800,025900,026001,026002,026003,026004,026100,026200,026301,026302,026303,026401,026402,026403,026404,030101,030102,030201,030202,030301,030302,030400,030500,030600,030700,030800,030900,031000,031100,031201,031202,031301,031302,031400,032601,032602,032700,032801,032802,032901,032902,033000,033100,033201,033203,033204,035100,035201,035202,035300,035400,040100,040200,042601,042602,042700,042800,045100,045200,047600,047701,047702,047801,047802,047901,047902,060100,060400,060502,060700,061000,061100,061200,061400,061500,980200,980300,980401,980501,980600,980900,990100

#San Mateo Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:81&for=tract:600100,600200,600300,600401,600402,600500,600600,600700,600800,600900,601000,601100,601200,601300,601400,601501,601502,601601,601603,601604,601605,601700,601800,601901,601902,602000,602100,602200,602300,602400,602500,602600,602700,602800,602900,603000,603100,603200,603300,603400,603700,603801,603802,603900,604000,604101,604102,604200,604400,604500,604600,604700,604800,604900,605000,605100,605200,605300,605400,605500,605600,605700,605800,605900,606000,606100,606200,606300,606400,606500,606600,606700,606800,606900,607000,607100,607200,607300,607400,607500,607600,607701,607702,607800,607900,608001,608002,608004,608013,608023,608100,608200,608300,608400,608501,608502,608600,608700,608800,608900,609000,609100,609201,609202,609300,609400,609500,609601,609602,609603,609700,609800,609900,610000,610100,610201,610202,610203,610302,610303,610304,610400,610500,610601,610602,610700,610800,610900,611000,611100,611200,611300,611400,611500,611600,611700,611800,611900,612000,612100,612500,612600,612700,612800,612900,613000,613200,613300,613400,613501,613502,613600,613700,613800,613900,614000,984300,990100

#Santa Clara Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:85&for=tract:500100,500200,500300,500400,500500,500600,500800,500901,500902,501000,501101,501102,501200,501300,501401,501402,501501,501502,501600,501700,501800,501900,502001,502002,502101,502102,502201,502202,502301,502302,502400,502500,502601,502603,502604,502701,502702,502800,502901,502902,502903,502906,502907,502908,502909,502910,503001,503002,503003,503105,503108,503110,503111,503112,503113,503115,503116,503117,503118,503121,503122,503123,503204,503207,503208,503210,503211,503212,503213,503214,503217,503218,503304,503305,503306,503312,503313,503315,503321,503322,503323,503324,503325,503326,503327,503329,503330,503331,503332,503333,503334,503336,503337,503401,503402,503504,503506,503507,503508,503509,503510,503511,503601,503602,503703,503707,503708,503709,503710,503711,503712,503713,503802,503803,503804,503902,503903,504001,504002,504101,504102,504201,504202,504307,504308,504311,504314,504315,504316,504317,504318,504319,504320,504321,504322,504323,504410,504411,504412,504413,504414,504415,504416,504417,504418,504420,504421,504422,504423,504504,504505,504506,504507,504601,504602,504700,504802,504803,504805,504806,504901,505001,505006,505007,505008,505009,505100,505202,505203,505301,505302,505303,505304,505305,505401,505402,505403,505500,505600,505700,505800,505900,506000,506101,506102,506103,506202,506203,506204,506301,506302,506304,506305,506401,506402,506501,506502,506503,506601,506603,506604,506605,506606,506701,506702,506703,506801,506802,506803,506804,506900,507001,507002,507100,507203,507205,507206,507301,507302,507401,507402,507500,507600,507701,507702,507703,507805,507806,507807,507808,507903,507904,507905,507906,508001,508003,508004,508101,508102,508202,508203,508204,508301,508303,508304,508401,508403,508404,508503,508504,508505,508507,508508,508601,508602,508703,508704,508800,508900,509000,509102,509105,509106,509107,509108,509109,509201,509202,509302,509303,509304,509401,509403,509404,509500,509600,509700,509801,509802,509901,509902,510001,510002,510100,510200,510300,510400,510500,510600,510700,510801,510802,510803,510900,511000,511100,511200,511301,511302,511400,511500,511608,511609,511701,511702,511704,511705,511707,511800,511905,511907,511909,511910,511911,511912,511913,511914,511915,511916,512001,512005,512017,512019,512020,512021,512022,512023,512024,512025,512026,512027,512029,512030,512031,512032,512033,512034,512035,512036,512037,512038,512039,512042,512043,512045,512047,512052,512053,512100,512200,512305,512307,512308,512309,512310,512311,512312,512313,512314,512401,512402,512503,512505,512506,512508,512509,512510,512602,512603,512604,513000,513500

#Solano Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:95&for=tract:250103,250104,250105,250106,250200,250300,250400,250501,250502,250601,250604,250605,250701,250801,250900,251000,251100,251200,251300,251400,251500,251600,251701,251702,251802,251803,251804,251901,251902,251903,252000,252102,252103,252104,252105,252106,252107,252108,252201,252202,252305,252306,252310,252311,252312,252313,252314,252315,252316,252317,252401,252402,252501,252502,252604,252605,252606,252607,252608,252610,252611,252702,252703,252704,252705,252706,252707,252801,252802,252903,252904,252908,252909,252910,252911,252912,252913,252914,252915,253000,253101,253105,253106,253107,253108,253201,253203,253204,253205,253206,253300,253402,253403,253404,253500,980000

#Sonoma Tracts
#http://api.census.gov/data/2014/acs5?get=NAME,B01001_001E&in=state:06+county:97&for=tract:150100,150202,150203,150204,150303,150304,150305,150306,150500,150601,150602,150603,150607,150609,150610,150611,150612,150701,150702,150800,150901,150902,151000,151100,151201,151203,151204,151301,151305,151306,151307,151308,151309,151310,151311,151401,151402,151502,151503,151504,151601,151602,151700,151800,151900,152000,152100,152201,152202,152203,152300,152400,152501,152502,152600,152701,152702,152801,152802,152903,152904,152905,152906,153001,153002,153003,153005,153006,153102,153103,153104,153200,153300,153401,153403,153404,153501,153502,153600,153703,153704,153705,153706,153801,153804,153806,153807,153808,153809,153901,153902,153903,154000,154100,154201,154202,154302,154303,154304,990100















#### Consume city of work commute mode data via Census API via acs package
```{r data - consume city of work commute mode data}
work_city_mode <- fromJSON(WORK_COMMUTE_CITY)
work_city_mode <- work_city_mode[2:length(work_city_mode)]

work_city_field <- sapply (work_city_mode, function(x) x[1])
work_city_Id <- sapply (work_city_mode, function(x) x[14])
Id <- paste ("1600000US06",work_city_Id, sep="")
Id2 <- paste ("6",work_city_Id, sep="")
work_city_mode_frame <- data.frame(Id, Id2, ACS_year, work_city_field, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(work_city_mode, function(x) as.numeric(x[i]))
  
  work_city_mode_frame <- cbind(work_city_mode_frame, data.frame(column))
}

work_city_mode_frame <- cbind(work_city_mode_frame, source2)

names(work_city_mode_frame) <-  c("Id", "Id2", "Year", "Workplace_Geo", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")


```



```{r data - create mode share data by geography}

work_city_mode_frame <- f.geography(work_city_mode_frame)
```

#### Melt data into proper shape for exporting CSVs

```{r data - create new data frame for city of work mode share}
work_city_share_frame <- work_city_mode_frame %>%
  select (Id, Id2, Workplace_Geo, Year, Workers_Est, DriveTot_Est, DriveAlone_Est, Carpool_Est, Transit_Est, Walk_Est, Other_w_Bike_Est, Bike_Est, Other_Est, Telework_Est, Source)

work_city_share_melt <- melt(work_city_share_frame, 
              id.vars=c("Id", "Id2", "Workplace_Geo","Year", "Workers_Est", "Source"),
              variable.name="Transport_Mode",
              value.name="Share"
              )

work_city_share_melt$Transport_Mode_Label <- values[match(work_city_share_melt$Transport_Mode, index)]

work_city_share_melt <- work_city_share_melt[c(1,2,3,4,5,7,9,8,6)]
 
#write.csv(work_city_share_melt , paste(work_share_output_csv, "5Year_Work_City_Mode_Share.csv", sep = ""), row.names = FALSE, quote = T)

```



```{r data - consume commute mode data for tracts - work tracts}

ALAMEDA_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:001&for=tract:",Alameda_work_share_tracts)

CONTRA_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:013&for=tract:",Contra_work_share_tracts)

MARIN_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:041&for=tract:",Marin_work_share_tracts)

NAPA_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:055&for=tract:",Napa_work_share_tracts)

FRANCISCO_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:075&for=tract:",Francisco_work_share_tracts)

MATEO_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:081&for=tract:",Mateo_work_share_tracts)

CLARA_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:085&for=tract:",Clara_work_share_tracts)

SOLANO_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:095&for=tract:",Solano_work_share_tracts)

SONOMA_WORK_COMMUTE_TRACTS = paste("http://api.census.gov/data/2014/acs5?get=NAME,B08601_001E,B08601_002E,B08601_003E,B08601_004E,B08601_010E,B08601_019E,B08601_018E,B08601_016E,B08601_017E,B08601_020E,B08601_021E&in=state:06+county:097&for=tract:",Sonoma_work_share_tracts)



alameda_work_tract_mode <- fromJSON(ALAMEDA_WORK_COMMUTE_TRACTS)
alameda_work_tract_mode <- alameda_work_tract_mode[2:length(alameda_work_tract_mode)]

tract_field <- sapply (alameda_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06001",tract_field,sep="")
Id2 <- paste ("6001",tract_field, sep="")
county <- paste ("Alameda County")
tract <- sapply((strsplit(as.character(sapply (alameda_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(alameda_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

alameda_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(alameda_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Contra Costa

contra_work_tract_mode <- fromJSON(CONTRA_WORK_COMMUTE_TRACTS)
contra_work_tract_mode <- contra_work_tract_mode[2:length(contra_work_tract_mode)]

tract_field <- sapply (contra_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06013",tract_field,sep="")
Id2 <- paste ("6013",tract_field, sep="")
county <- paste ("Contra Costa County")
tract <- sapply((strsplit(as.character(sapply (contra_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(contra_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

contra_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(contra_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Marin

marin_work_tract_mode <- fromJSON(MARIN_WORK_COMMUTE_TRACTS)
marin_work_tract_mode <- marin_work_tract_mode[2:length(marin_work_tract_mode)]

tract_field <- sapply (marin_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06041",tract_field,sep="")
Id2 <- paste ("6041",tract_field, sep="")
county <- paste ("Marin County")
tract <- sapply((strsplit(as.character(sapply (marin_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(marin_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

marin_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(marin_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Napa

napa_work_tract_mode <- fromJSON(NAPA_WORK_COMMUTE_TRACTS)
napa_work_tract_mode <- napa_work_tract_mode[2:length(napa_work_tract_mode)]

tract_field <- sapply (napa_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06055",tract_field,sep="")
Id2 <- paste ("6055",tract_field, sep="")
county <- paste ("Napa County")
tract <- sapply((strsplit(as.character(sapply (napa_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(napa_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

napa_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(napa_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#San Francisco

francisco_work_tract_mode <- fromJSON(FRANCISCO_WORK_COMMUTE_TRACTS)
francisco_work_tract_mode <- francisco_work_tract_mode[2:length(francisco_work_tract_mode)]

tract_field <- sapply (francisco_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06075",tract_field,sep="")
Id2 <- paste ("6075",tract_field, sep="")
county <- paste ("San Francisco County")
tract <- sapply((strsplit(as.character(sapply (francisco_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(francisco_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

francisco_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(francisco_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#San Mateo

mateo_work_tract_mode <- fromJSON(MATEO_WORK_COMMUTE_TRACTS)
mateo_work_tract_mode <- mateo_work_tract_mode[2:length(mateo_work_tract_mode)]

tract_field <- sapply (mateo_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06081",tract_field,sep="")
Id2 <- paste ("6081",tract_field, sep="")
county <- paste ("San Mateo County")
tract <- sapply((strsplit(as.character(sapply (mateo_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(mateo_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

mateo_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(mateo_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Santa Clara

clara_work_tract_mode <- fromJSON(CLARA_WORK_COMMUTE_TRACTS)
clara_work_tract_mode <- clara_work_tract_mode[2:length(clara_work_tract_mode)]

tract_field <- sapply (clara_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06085",tract_field,sep="")
Id2 <- paste ("6085",tract_field, sep="")
county <- paste ("Santa Clara County")
tract <- sapply((strsplit(as.character(sapply (clara_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(clara_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

clara_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(clara_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Solano

solano_work_tract_mode <- fromJSON(SOLANO_WORK_COMMUTE_TRACTS)
solano_work_tract_mode <- solano_work_tract_mode[2:length(solano_work_tract_mode)]

tract_field <- sapply (solano_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06095",tract_field,sep="")
Id2 <- paste ("6095",tract_field, sep="")
county <- paste ("Solano County")
tract <- sapply((strsplit(as.character(sapply (solano_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(solano_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

solano_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(solano_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

#Sonoma

sonoma_work_tract_mode <- fromJSON(SONOMA_COMMUTE_TRACTS)
sonoma_work_tract_mode <- sonoma_work_tract_mode[2:length(sonoma_work_tract_mode)]

tract_field <- sapply (sonoma_work_tract_mode, function(x) x[15])
Id <- paste ("1400000US06097",tract_field,sep="")
Id2 <- paste ("6097",tract_field, sep="")
county <- paste ("Sonoma County")
tract <- sapply((strsplit(as.character(sapply (sonoma_work_tract_mode, function(x) x[1])),',')),function(x) x[1])


tract_mode_frame <- data.frame(Id, Id2, county, tract, ACS_year, stringsAsFactors=F)

for (i in 2:12){
  column <- sapply(sonoma_work_tract_mode, function(x) as.numeric(x[i]))
  
  tract_mode_frame <- cbind(tract_mode_frame, data.frame(column))
}

sonoma_work_tract_mode_frame <- cbind(tract_mode_frame, source2)

names(sonoma_work_tract_mode_frame) <-  c("Id", "Id2", "County", "Tract", "Year", "Workers_Est", "Drive_Total","DAWorkers_Est", "CPWorkers_Est", "PTWorkers_Est", "Walk", "Bike", "Taxi", "Motorcycle", "Other", "AtHome", "Source")

allcounties_work_tract_mode_frame <- rbind (alameda_work_tract_mode_frame,contra_work_tract_mode_frame,marin_work_tract_mode_frame,napa_work_tract_mode_frame,francisco_work_tract_mode_frame,mateo_work_tract_mode_frame,clara_work_tract_mode_frame,solano_work_tract_mode_frame,sonoma_work_tract_mode_frame)

allcounties_work_tract_mode_frame <- f.geography(allcounties_work_tract_mode_frame)

#Melt data into proper shape for exporting CSVs


allcounties_work_tract_share_frame <- allcounties_work_tract_mode_frame %>%
  select (Id, Id2, County, Tract, Year, Workers_Est, DriveTot_Est, DriveAlone_Est, Carpool_Est, Transit_Est, Walk_Est, Other_w_Bike_Est, Bike_Est, Other_Est, Telework_Est, Source)

allcounties_work_tract_share_melt <- melt(allcounties_work_tract_share_frame, 
              id.vars=c("Id", "Id2", "County","Tract", "Year", "Workers_Est", "Source"),
              variable.name="Transport_Mode",
              value.name="Share"
              )

allcounties_work_tract_share_melt$Transport_Mode_Label <- values[match(allcounties_work_tract_share_melt$Transport_Mode, index)]

allcounties_work_tract_share_melt <- allcounties_work_tract_share_melt[c(1,2,3,4,5,6, 8,10,9,7)]
 
#write.csv(allcounties_tract_share_melt , paste(share_output_csv, "5Year_City_Mode_Share.csv", sep = ""), row.names = FALSE, quote = T)

```
